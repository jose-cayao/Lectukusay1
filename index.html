<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LectuKushay</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Variables para colores */
        :root {
            --primary-color: #00324e;
            --secondary-color: #129cec;
            --accent-color: #f32f19;
            --success-color: #fca503;
            --bg-color: #f7f8fa;
            --text-color: #070707;
            --card-bg: #ffffff;
            --border-color: #03376b;
            /* Modo Oscuro */
            --background-dark: #2c3e50; /* Azul oscuro */
            --text-dark: #ecf0f1; /* Gris claro */
            --card-background-dark: #34495e; /* Azul oscuro m√°s claro */

            /* Niveles de puntaje actualizados */
            --level-c-color: #e74c3c; /* Rojo para Inicio */
            --level-b-color: #f39c12; /* Amarillo para Proceso */
            --level-a-color: #ff8c00; /* Anaranjado para Logrado */
            --level-ad-color: #27ae60; /* Verde para Logro Destacado */
        }
/* Estilos para la doble columna */
.two-column-layout {
    display: flex;
    gap: 20px; /* Espacio entre columnas */
    margin-bottom: 20px;
}

.column-text {
    flex: 1; /* Distribuye el espacio equitativamente */
    padding: 15px;
    /* Usamos el mismo color de borde que la separaci√≥n principal para mantener la coherencia */
    border-right: 1px solid #ddd; 
}

.column-text:last-child {
    border-right: none;
}

/* Ajuste del autor y el t√≠tulo de las sub-columnas */
.column-text h3 {
    margin-top: 0;
}

.author-label {
    font-size: 0.9em;
    color: #666;
    margin-top: -10px;
    margin-bottom: 10px;
}

/* Estilos para el resumen de respuestas */
.results-list {
    list-style-type: none;
    padding-left: 0;
}

.results-list li {
    padding: 10px;
    margin-bottom: 8px;
    border-radius: 5px;
    border-left: 5px solid;
    transition: background-color 0.3s;
}

.results-list li.correct {
    background-color: #e6ffed; /* Verde muy claro */
    border-color: #4CAF50; /* Verde */
}

.results-list li.incorrect {
    background-color: #ffeded; /* Rojo muy claro */
    border-color: #F44336; /* Rojo */
}

.results-list p {
    margin: 5px 0;
    line-height: 1.4;
}

/* --- Compatibilidad con Modo Oscuro (Dark Mode) --- */

body.dark-mode .column-text {
    border-right: 1px solid #4a637d; /* Borde oscuro para la doble columna */
}

body.dark-mode .author-label {
    color: #bdc3c7;
}

body.dark-mode .results-list li.correct {
    background-color: #1a361c;
    color: #a5d6a7;
    border-color: #388e3c;
}

body.dark-mode .results-list li.incorrect {
    background-color: #361a1a;
    color: #ef9a9a;
    border-color: #d32f2f;
}
        body {
            font-family: 'Poppins', sans-serif;
            margin: 20;
            padding: 20;
            background: var(--background-light); /* Aplicar el degradado al fondo */
            color: var(--text-light);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
            color: var(--text-color);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        /* Modo oscuro */
        body.dark-mode {
            background-color: var(--background-dark);
            color: var(--text-dark);
        }

        body.dark-mode header {
            background-color: var(--card-background-dark);
            color: var(--text-dark);
        }

        body.dark-mode .sidebar {
            background-color: var(--card-background-dark);
            color: var(--text-dark);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .student-form input,
        body.dark-mode .controls select {
            background-color: var(--card-background-dark);
            color: var(--text-dark);
            border: 1px solid white;
        }

        /* Botones en modo oscuro tambi√©n amarillos */
        body.dark-mode .student-form button,
        body.dark-mode .btn-primary,
        body.dark-mode .btn-secondary,
        body.dark-mode .controls button,
        body.dark-mode .visual-options button {
            background-color: var(--secondary-color);
            color: white; /* Asegurar texto blanco en botones amarillos */
            border: 1px solid var(--secondary-color); /* Borde amarillo en modo oscuro */
        }
        body.dark-mode .student-form button:hover,
        body.dark-mode .btn-primary:hover,
        body.dark-mode .btn-secondary:hover,
        body.dark-mode .controls button:hover,
        body.dark-mode .visual-options button:hover {
            background-color: #e0a027; /* Amarillo m√°s oscuro al pasar el rat√≥n en modo oscuro */
        }


        body.dark-mode .text-display,
        body.dark-mode .quiz-section,
        body.dark-mode .comment-section {
            background-color: var(--card-background-dark);
            color: var(--text-dark);
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: rgb(255, 251, 0);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.966);
         
         

        }

        header h1 {
            margin: 0;
            font-size: 4.7rem;
            display: inline-block; /* Permitir que h1 se siente al lado de la imagen */
            vertical-align: middle; /* Alinear con la imagen */
            margin-right: 15px; /* Espacio entre el t√≠tulo y el slogan */
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        #logo {
            vertical-align: middle;
            margin-right: 10px;
            border-radius: 80%;
            max-width: 90px; /* Tama√±o m√°ximo del logo */
            height: auto;
        }

        #logo1 {
            vertical-align: middle;
            margin-right: 05px;
            border-radius: 10%;
            max-width: 90px; /* Tama√±o m√°ximo del logo */
            height: auto;
            opacity: 0.5; /* opacidad del titulo */
        }
        .slogan-container {
            margin-top: 0.1rem; /* Espacio entre el t√≠tulo y el slogan */
            width: 100%; /* Ocupar todo el ancho para el marquee */
        }

        .slogan-container p {
            margin: 0; /* Eliminar m√°rgenes predeterminados del p√°rrafo dentro del marquee */
            font-size: 1.2rem;
        }

        main {
            display: flex;
            flex: 1;
            padding: 1.5rem;
            gap: 1.5rem;
        }

        .sidebar {
            flex: 0 0 280px; /* Ancho fijo para la barra lateral en desktop */
            background-color: #b8d4f017;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px #00324e;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-left: 0;
            overflow-y: auto;
            max-height: calc(100vh - 120px);
        
        }

        /* T√≠tulos en el sidebar y secciones de contenido */
        .sidebar h2, .sidebar h3,
        .text-display h2,
        .quiz-section h2, .comment-section h2,
        .visual-options h3,
        .eval-section h2 {
            color: var(--primary-color);
            margin-top: 0;
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 0.7rem;
            margin-bottom: 1.2rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        /* Mejorar contraste de texto en cards */
        .sidebar h3 {
            font-size: 1.1rem;
            color: #00324e;
        }

        /* Estilo para los contenedores de input con bot√≥n de voz */
        .input-with-speech {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
            margin-bottom: 1rem;
        }

        .input-with-speech input {
            padding: 0.8rem;
            border-radius: 8px;
            border: 2px solid var(--primary-color);
            font-size: 1rem;
            box-sizing: border-box;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            width: 100%;
        }

        .input-with-speech input:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 8px rgba(18, 156, 236, 0.7);
            outline: none;
        }

        .input-with-speech button {
            padding: 0.6rem;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            min-height: 44px;
            transition: background-color 0.2s;
            align-self: flex-start;
            width: auto;
            min-width: 44px;
        }

        .input-with-speech button:hover {
            background-color: #0d7ab8;
        }

        .input-with-speech button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Estilo para todos los botones */
        .student-form button, .btn-primary, .btn-secondary, .text-actions button, .visual-options button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 0.8rem 1.2rem;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            min-height: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .student-form button:hover, .btn-primary:hover, .text-actions button:hover, .visual-options button:hover {
            background-color: #024073;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: #129cec;
        }

        .btn-secondary:hover {
            background-color: #0d7ab8;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transform: translateY(-2px);
        }

        .student-form button:active, .btn-primary:active, .btn-secondary:active, 
        .text-actions button:active, .visual-options button:active {
            transform: translateY(0);
        }

        /* Estilo espec√≠fico para los botones de dictado de voz */
        .speech-input-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.6rem;
            cursor: pointer;
            font-size: 1.2rem;
            min-height: 44px;
            min-width: 44px;
            transition: all 0.2s ease;
        }

        .speech-input-btn:hover {
            background-color: #0d7ab8;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }

        /* Separaci√≥n espec√≠fica para botones de la secci√≥n de Evaluaciones */
        .evaluations button {
            margin-right: 0.6rem;
            margin-bottom: 0.6rem;
        }

        /* Modo oscuro para los botones de dictado de voz */
        body.dark-mode .speech-input-btn {
            background-color: var(--secondary-color);
            color: white;
        }
        body.dark-mode .speech-input-btn:hover {
            background-color: #3a6a9a; /* Azul m√°s oscuro al pasar el rat√≥n */
        }

        .student-info p {
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        #levelAchieved {
            font-weight: bold;
            padding: 0.3rem 0.6rem;
            border-radius: 5px;
            display: inline-block;
        }

        .level-c { background-color: var(--level-c-color); color: white; }
        .level-b { background-color: var(--level-b-color); color: white; }
        .level-a { background-color: var(--level-a-color); color: white; }
        .level-ad { background-color: var(--level-ad-color); color: white; }

        .reading-record ul, .ranking ol {
            list-style: none;
            padding: 0;
        }

        .reading-record li, .ranking li {
            padding: 0.5rem 0;
            border-bottom: 1px dashed #eee;
            display: flex; /* Para alinear el texto y el bot√≥n de borrar */
            justify-content: space-between;
            align-items: center;
        }

        .ranking li .delete-student-btn {
            background: none;
            border: none;
            color: #e74c3c; /* Rojo para el icono de borrar */
            cursor: pointer;
            font-size: 1.1rem;
            transition: color 0.2s ease;
            padding: 0.2rem;
        }

        .ranking li .delete-student-btn:hover {
            color: #c0392b; /* Rojo m√°s oscuro al pasar el rat√≥n */
        }


        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--card-background-light);
            padding: 1rem 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 8px #00324e;
            flex-wrap: wrap;
            gap: 1rem;
            background-color: #b8d4f017;
        }

        .controls select {
            padding: 0.8rem;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 1rem;
            background-color: white;
            cursor: pointer;
        }

        .text-actions button {
            margin-left: 0.5rem; /* Mantener margen entre botones de acci√≥n de texto */
        }

        .text-display, .quiz-section, .comment-section {
            background-color: var(--card-background-light);
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 8px #00324e;
            min-height: 300px; /* Para asegurar un tama√±o m√≠nimo */
        }

        .text-display .author {
            color: #111010;
            font-style: italic;
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
        }

        #textContent { /* Aplicar el tama√±o de fuente directamente aqu√≠ */
            line-height: 1.8;
            margin-bottom: 1rem;
            font-size: 1.1rem; /* Tama√±o de texto inicial */
        }

        #textContent p { /* Eliminar font-size de aqu√≠ para que el del padre funcione */
            margin-bottom: 1rem;
        }

        .placeholder-text {
            text-align: center;
            color: #888;
            padding: 50px;
            font-style: italic;
        }

        .reading-message {
            background-color: var(--accent-color);
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            font-size: 1.3rem;
            font-weight: bold;
            margin-top: 1rem;
        }

        .question {
            margin-bottom: 1.5rem;
            border-bottom: 1px dashed #eee;
            padding-bottom: 1rem;
        }

        .question p {
            font-weight: bold;
            margin-bottom: 0.8rem;
            font-size: 1.1rem;
        }

        /* Estilo para inputs de respuesta corta y labels de radio */
        .question .short-answer-input {
            width: 100%; /* Ocupar todo el ancho disponible */
            padding: 0.8rem;
            border: 1px solid var(--primary-color); /* Borde con color primario */
            border-radius: 8px; /* Bordes m√°s redondeados */
            font-size: 1rem;
            box-sizing: border-box; /* Incluir padding y border en el ancho/alto */
            margin-top: 0.5rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .question .short-answer-input:focus {
            border-color: var(--secondary-color); /* Borde amarillo al enfocar */
            box-shadow: 0 0 5px rgba(247, 179, 43, 0.5); /* Sombra amarilla al enfocar */
            outline: none; /* Eliminar el contorno por defecto */
        }

        .question label {
            display: block;
            margin-bottom: 0.5rem;
            cursor: pointer;
            font-size: 1rem;
            padding: 0.6rem; /* A√±adir padding para mejor √°rea de clic */
            border-radius: 5px;
            transition: background-color 0.2s ease;
        }

        .question label:hover {
            background-color: #f0f0f0; /* Fondo sutil al pasar el rat√≥n */
        }
        body.dark-mode .question label:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .quiz-feedback {
            margin-top: 1rem;
            font-weight: bold;
        }

        /* Comment Section */
        .comment-input-area {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .comment-input-area textarea {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            margin-bottom: 0; /* Eliminar margen individual */
            box-sizing: border-box; /* Incluir padding y border en el ancho/alto */
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        body.dark-mode .comment-input-area textarea {
            background-color: var(--card-background-dark);
            color: var(--text-dark);
            border: 1px solid var(--accent-color);
        }
        .comment-input-area textarea:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 5px rgba(247, 179, 43, 0.5);
            outline: none;
        }

        /* New Visual Options Section */
        .visual-options {
            margin-bottom: 1.5rem; /* Espacio debajo de esta secci√≥n */
            padding-bottom: 1rem;
            border-bottom: 1px dashed #dddbe4; /* Separador */
        }

        footer {
             background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            text-align: center;
            padding: 0px;
            border-radius: 7px;
            margin: 0px;
        }

        /* Media Queries para Responsividad */
        /* Laptop/Desktop (1200px en adelante) - estilos base */
        
        /* Tablet en horizontal y laptops peque√±os (1025px - 1199px) */
        @media (max-width: 1199px) {
            main {
                gap: 1rem;
                padding: 1rem;
            }
            
            .sidebar {
                flex: 0 0 250px;
            }
        }
        
        /* Tablet (768px - 1024px) */
        @media (max-width: 1024px) {
            main {
                flex-direction: column;
                padding: 1rem;
                gap: 1rem;
            }

            .sidebar {
                flex: 0 0 auto;
                width: 100%;
                max-width: 100%;
                margin-left: 0;
            }

            .controls {
                flex-direction: column;
                align-items: flex-start;
            }

            .text-actions {
                margin-top: 1rem;
                display: flex;
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .text-actions button {
                margin-left: 0;
                margin-right: 0;
                margin-bottom: 0;
                flex: 0 1 auto;
            }
            
            header h1 {
                font-size: 1.8rem;
            }

            .text-display h2 {
                font-size: 1.6rem;
            }
        }

        /* Tablet peque√±a/Smartphone en horizontal (481px - 768px) */
        @media (max-width: 768px) {
            body {
                font-size: 14px;
            }
            
            header h1 {
                font-size: 1.5rem;
            }

            main {
                padding: 0.75rem;
                gap: 0.75rem;
            }

            .sidebar, .text-display, .quiz-section, .eval-section, .controls {
                padding: 0.75rem;
            }
            
            .sidebar {
                gap: 1rem;
            }

            .text-display h2 {
                font-size: 1.3rem;
            }

            #textContent {
                font-size: 0.95rem;
                line-height: 1.6;
            }
            
            .text-actions {
                gap: 0.35rem;
            }
            
            .text-actions button {
                font-size: 0.85rem;
                padding: 0.4rem 0.6rem;
                min-height: 40px;
            }

            button, input, select {
                min-height: 40px;
            }

            .student-form input, .student-form button {
                min-height: 40px;
            }

            .input-label {
                font-size: 0.9rem;
            }
        }

        /* Smartphone (hasta 480px) */
        @media (max-width: 480px) {
            body {
                font-size: 13px;
            }
            
            header h1 {
                font-size: 1.2rem;
            }
            
            header img {
                height: 40px;
            }

            main {
                padding: 0.5rem;
                gap: 0.5rem;
                flex-direction: column;
            }
            
            .sidebar {
                padding: 0.75rem;
                gap: 0.75rem;
                max-height: none;
            }

            .student-form input, .student-form button,
            .controls select, .text-actions button {
                font-size: 0.9rem;
                padding: 0.6rem 0.8rem;
                width: 100%;
                min-height: 44px; /* Tama√±o m√≠nimo de toque para accesibilidad */
            }

            .input-label {
                font-size: 0.85rem;
                margin-bottom: 0.2rem;
            }

            .text-display h2 {
                font-size: 1.1rem;
            }
            
            #textContent {
                font-size: 0.9rem;
                line-height: 1.6;
            }
            
            .text-actions {
                flex-direction: column;
                gap: 0.4rem;
            }
            
            .text-actions button {
                width: 100%;
                min-height: 44px;
            }
            
            .controls {
                gap: 0.5rem;
                padding: 0.75rem;
            }
            
            .text-selector {
                width: 100%;
            }

            .input-with-speech {
                width: 100%;
                display: flex;
                flex-direction: column;
                gap: 0.3rem;
            }

            .speech-input-btn {
                min-height: 44px;
                padding: 0.5rem;
            }

            /* Mejorar legibilidad de preguntas */
            .question {
                padding: 0.75rem;
                margin-bottom: 0.75rem;
                font-size: 0.9rem;
            }

            .question p {
                margin: 0.3rem 0;
            }

            label {
                padding: 0.4rem;
                font-size: 0.9rem;
            }
        }

        /* Centrar t√≠tulo de Evaluaci√≥n */
        #evalSection #evalTitle {
            text-align: center;
            margin-bottom: 0.5rem;
        }

        /* Mejoras de accesibilidad para inputs */
        .input-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.3rem;
            font-size: 0.9rem;
        }

        input:focus, select:focus, textarea:focus {
            outline: 3px solid var(--secondary-color);
            outline-offset: 2px;
        }

        button:focus {
            outline: 3px solid var(--secondary-color);
            outline-offset: 2px;
        }

        /* Mejorar contraste en botones */
        .btn-primary, .btn-secondary {
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(18, 156, 236, 0.3);
        }

        .btn-secondary:hover {
            background-color: #0a5fa6;
            transform: translateY(-2px);
        }

        .btn-secondary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <header>
        <img id="logo" src="https://i.pinimg.com/736x/ed/5c/99/ed5c999a1162251cf4efd18c4b09a1cc.jpg" alt="Logo LectuKushay - Plataforma de lectura educativa">
        <b><h1>LectuKushay</h1></b>
        <div class="slogan-container">
            <!-- Nota: La etiqueta <marquee> est√° obsoleta y puede no ser compatible en futuros navegadores. -->
            <b><marquee behavior="scroll" direction="left" scrollamount="5"><p>¬°La alegr√≠a de leer comienza aqu√≠!</p></marquee></b>
        </div>
    </header>

    <main>
        <aside class="sidebar">
            <div class="visual-options"> <!-- Nueva secci√≥n para opciones visuales, ahora al inicio del sidebar -->
                <h3>Opciones de Visualizaci√≥n</h3>
                <button id="toggleThemeBtn">üåô Modo Oscuro / ‚òÄÔ∏è Modo Claro</button>
            </div>
            <h2>Panel de Estudiante</h2>
            <div class="student-form">
                <h3>Ingresa tus datos:</h3>
                <div class="input-with-speech">
                    <label for="studentName" class="input-label">Nombre completo:</label>
                    <input type="text" id="studentName" placeholder="Ej: Juan P√©rez" required aria-label="Nombre completo del estudiante">
                    <button class="speech-input-btn" data-target="studentName" title="Dictar nombre">üé§</button>
                </div>
                <div class="input-with-speech">
                    <label for="studentGrade" class="input-label">Grado:</label>
                    <input type="text" id="studentGrade" placeholder="Ej: 3ro A" required aria-label="Grado del estudiante">
                    <button class="speech-input-btn" data-target="studentGrade" title="Dictar grado">üé§</button>
                </div>
                <button id="activateStudent" class="btn-primary">Activar Estudiante</button>
            </div>
            <div class="student-info"> <!-- Removed style="display:none;" -->
                <p>¬°Bienvenido(a), <span id="currentStudentName"></span>!</p>
                <p>Grado: <span id="currentStudentGrade"></span></p>
                <p>Puntaje Total: <span id="totalScore">0</span></p>
                <p>Nivel Alcanzado: <span id="levelAchieved" class="level-c">Inicio (C)</span></p>
                <button id="registerNewStudentBtn" class="btn-secondary" style="margin-top: 1rem;">Registrar Nuevo Estudiante</button>
                
            </div>
            <div class="reading-record">
                <h3>Record de Lectura:</h3>
                <ul id="readTextsList">
                    <!-- Textos le√≠dos se a√±adir√°n aqu√≠ -->
                </ul>
            </div>
            <div class="ranking">
                <h3>Ranking:</h3>
                <ol id="studentRanking">
                    <!-- El ranking de estudiantes se cargar√° aqu√≠ -->
                </ol>
            </div>
            <div class="evaluations">
                <h3>Evaluaciones</h3>
                <button id="startEntryEvalBtn" class="btn-secondary">Iniciar Evaluaci√≥n de Entrada</button>
                <button id="startExitEvalBtn" class="btn-secondary">Iniciar Evaluaci√≥n de Salida</button>
                <button id="exportAnswersBtn" class="btn-secondary">Exportar Respuestas (.xls)</button>
            </div>
        </aside>

        <section class="content-area">
            <nav class="controls">
                <div class="text-selector">
                    <label for="textCategory">Elige tu aventura:</label>
                    <select id="textCategory">
                        <option value="actividad01">Actividad 01</option>
                        <option value="actividad02">Actividad 02</option>
                        <option value="actividad03">Actividad 03</option>
                        <option value="actividad04">Actividad 04</option>
                        <option value="actividad05">Actividad 05</option>
                        <option value="actividad06">Actividad 06</option>
                        <option value="actividad07">Actividad 07</option>
                        <option value="actividad08">Actividad 08</option>
                        <option value="actividad09">Actividad 09</option>
                        <option value="actividad10">Actividad 10</option>
                    </select>
                </div>
                <div class="text-actions">
                    <!-- Un solo bot√≥n para Leer/Pausar/Reanudar -->
                    <button id="readAloudBtn">üó£Ô∏è Leer en Voz Alta</button>
                    <button id="increaseFontSizeBtn">A+</button>
                    <button id="decreaseFontSizeBtn">A-</button>
                    <button id="exportActivityBtn" class="btn-secondary">Exportar Actividad (.xls)</button>
                </div>
            </nav>

            <article class="text-display" role="article">
                <h2 id="textTitle"></h2>
                <div id="textAuthor" class="author" role="doc-subtitle"></div>
                <div id="textContent" role="main">
                    <p class="placeholder-text">Selecciona una categor√≠a de texto y luego un texto para empezar a leer. ¬°La aventura te espera!</p>
                </div>
                <button id="startQuizBtn" class="btn-primary" style="display:none;">Termin√© de leer, ¬°a la comprensi√≥n!</button>
            </article>

            <section id="readingMessage" class="reading-message" style="display:none;">
                <p>¬°Bien hecho! Has terminado esta lectura. üéâ</p>
            </section>

            <section id="quizSection" class="quiz-section" style="display:none;" role="region" aria-label="Secci√≥n de preguntas de comprensi√≥n">
                <h2>Preguntas de Comprensi√≥n</h2>
                <div id="quizQuestions">
                    <!-- Preguntas del quiz se cargar√°n aqu√≠ -->
                </div>
                <button id="submitQuizBtn" class="btn-primary">Enviar Respuestas</button>
                <button id="retryQuizBtn" class="btn-secondary" style="display:none;">Intentar de Nuevo</button>
                <p id="quizFeedback" role="alert" aria-live="polite"></p>
            </section>

            <!-- Comentarios de estudiante removidos (requerimiento) -->
            <section id="evalSection" class="eval-section" style="display:none;" role="region" aria-label="Secci√≥n de evaluaci√≥n">
                <h2 id="evalTitle">Evaluaci√≥n</h2>
                <div id="evalProgress" style="margin-bottom:0.5rem; font-weight:bold;" role="status" aria-live="polite"></div>
                <div id="evalTextContainer" class="eval-text-container" role="main"></div>
                <div id="evalQuizContainer" class="eval-quiz-container"></div>
                <button id="submitEvalBtn" class="btn-primary">Enviar Respuestas</button>
                <div id="evalSummary" style="margin-top:1rem;" role="status" aria-live="polite"></div>
            </section>
        </section>
    </main>

    <footer>
            <p>¬© 2025 LectuKushay Plataforma Educativa Interactiva</p>
            <p>¬© 2025 Jos√© Lenis Cayao Bustamante</p>
            <p>Desarrollado para fomentar la lectura y comprensi√≥n en estudiantes de secundaria</p>
    </footer>

    <script>
        // --- Data de Textos (JSON embebido) ---
         const entradaData = [
            {
                "title": "¬øQu√© significa llevar una vida saludable?",
                "author": "Lic. Julissa Choque Pazos / Psic√≥loga del Centro de Salud ‚ÄòSan Juan Mac√≠as - Minedu 2023",
                "content": [
                "Las definiciones y enfoques pueden variar significativamente. En este escenario, se debate sobre si existe una √∫nica f√≥rmula para una vida saludable o si esta es una construcci√≥n personal y subjetiva, basada en factores individuales y valores culturales.",
                    "Mientras algunos sostienen que la vida saludable est√° vinculada a pr√°cticas como la actividad f√≠sica regular y una dieta balanceada, otros argumentan que la salud mental y emocional, as√≠ como la calidad del sue√±o y las relaciones interpersonales, son igualmente cruciales. El dilema se intensifica cuando se considera la presi√≥n social y los est√°ndares est√©ticos que pueden distorsionar la percepci√≥n de una vida saludable.",
                    "Tambi√©n, es esencial reflexionar sobre c√≥mo los valores culturales y las expectativas individuales influyen en nuestras elecciones y percepciones. La comunidad de bienestar se encuentra desafiada a promover una definici√≥n hol√≠stica de la salud, que incluya aspectos f√≠sicos, mentales y emocionales, y a reconocer la diversidad de caminos que pueden llevar a una vida plena y equilibrada",
                    "La reflexi√≥n sobre estos temas nos invita a considerar c√≥mo las distintas definiciones de vida saludable pueden adaptarse a nuestras necesidades individuales y contextos culturales. En este cruce de perspectivas y h√°bitos, la apertura al di√°logo cr√≠tico y la aceptaci√≥n de la diversidad de enfoques se vuelven esenciales para moldear una visi√≥n de la vida saludable que resuene con la autenticidad y bienestar de cada individuo.",
                 ],
                "quiz": [
                    {
                        "question": "Seg√∫n la autora del primer texto, ¬øqu√© est√° en debate sobre tener una vida saludable",
                        "type": "multiple-choice",
                        "options": ["Si la vida saludable est√° vinculada a pr√°cticas como la actividad f√≠sica regular y una dieta balanceada", "Si para tener una vida saludable son cruciales la salud mental y emocional, la calidad de sue√±o y relaciones interpersonales", "Si la vida saludable incluye aspectos f√≠sicos, mentales y emocionales", "Si existe una √∫nica f√≥rmula para la vida saludable o si es una construcci√≥n personal y subjetiva"],
                        "answer": "Si existe una √∫nica f√≥rmula para la vida saludable o si es una construcci√≥n personal y subjetiva"
                    },
                    {
                        "question": "Seg√∫n Carla Pachas, ¬øqu√© tipo de acciones debemos evitar al buscar un estilo de vida saludable?",
                        "type": "multiple-choice",
                        "options": ["Acciones que impliquen sacrificios abrumadores o sufrimientos humanos.", "Acciones que permitan adoptar h√°bitos equilibrados, como una alimentaci√≥n variada", "Acciones sostenibles y realistas a largo plazo", "Acciones para disfrutar de los peque√±os placeres"],
                        "answer": "Acciones que impliquen sacrificios abrumadores o sufrimientos humanos."
                    },
                    {
                        "question": "En el texto de Julissa Choque, ¬øa qu√© se refiere la palabra hol√≠stica?",
                        "type": "multiple-choice",
                        "options": ["A la integralidad.", "A un desaf√≠o.", "A la inclusi√≥n.", "A la diversidad"],
                        "answer": "A la integralidad."
                    },
                    {
                        "question": "Lee esta parte del texto, ‚Äú(‚Ä¶) debemos aprender a disfrutar de los peque√±os placeres (y, por qu√© no, permitirnos algunos ‚Äògustitos‚Äô ocasionales)‚Äù. ¬øCon qu√© intenci√≥n la autora incluye la informaci√≥n entre par√©ntesis?",
                        "type": "multiple-choice",
                        "options": ["Precisar datos espec√≠ficos.", "Insertar informaci√≥n complementaria. ", "Aclarar la definici√≥n adecuada.", "Narrar un hecho complementario."],
                        "answer": "Insertar informaci√≥n complementaria."
                    }
                ]
            },
            {
                "title": "Vida Saludable: Equilibrio y Extremos",
                "author": "Lic. Carla Pachas Vidal - Minedu 2023",
                "content": [
                "En la era actual, la b√∫squeda de un estilo de vida saludable se ha convertido en un objetivo v√°lido, pero debemos evitar extremos que puedan generarnos m√°s estr√©s que beneficios. En medio de las modas y las presiones sociales, es esencial recordar que buscar la vida saludable no implica sacrificios abrumadores ni sufrimientos inhumanos.",
                "Practicar la moderaci√≥n como un camino para la vida saludable nos permite comprender que el bienestar no debe convertirse en una fuente de ansiedad. De esta manera, adoptar h√°bitos equilibrados, como una alimentaci√≥n variada y la incorporaci√≥n de actividad f√≠sica agradable, se vuelve m√°s sostenible y realista a largo plazo.",
                "A pesar de las expectativas actuales, para vivir una vida saludable tambi√©n debemos aprender a disfrutar de los peque√±os placeres (y, por qu√© no, permitirnos algunos ‚Äògustitos‚Äô ocasionales). La obsesi√≥n con la perfecci√≥n en la dieta o el ejercicio puede generar m√°s estr√©s que beneficios reales.",
                "En resumen, el bienestar no debe convertirse en una carga nos insta a apreciar la diversidad y flexibilidad en nuestras elecciones diarias. En un mundo obsesionado con los est√°ndares, encontrar el equilibrio en la b√∫squeda de la salud es la verdadera clave para cultivar una vida plena y sostenible.",    
            ],
                "quiz": [
                    {
                        "question": "¬øQu√© idea es com√∫n entre ambos textos?",
                        "type": "multiple-choice",
                        "options": ["Debemos aceptar y disfrutar el equilibrio de acuerdo con nuestra diversidad y bienestar.", "Debemos adoptar buenos h√°bitos y disfrutar de los peque√±os placeres.", "Debemos encontrar una visi√≥n saludable sin la obsesi√≥n de la perfecci√≥n", "Debemos respetar nuestros valores culturales y percepciones sociales"],
                        "answer": "Debemos encontrar una visi√≥n saludable sin la obsesi√≥n de la perfecci√≥n."
                    },
                    {
                        "question": "Seg√∫n Carla Pachas, buscar una vida saludable no implica sacrificios abrumadores ni sufrimientos inhumanos. ¬øCu√°l de las siguientes ideas presentes en el texto de Julissa Choque incide sobre este mismo aspecto y complementa lo dicho por Carla Pachas?",
                        "type": "multiple-choice",
                        "options": ["La vida saludable incluye aspectos f√≠sicos, mentales y emocionales, y es necesario aceptar que se puede llegar a ella de diversas maneras.", "La presi√≥n social y los est√°ndares est√©ticos pueden distorsionar la idea de una vida saludable.", "La vida saludable se vincula con la actividad f√≠sica regular y una dieta balanceada.", "Son cruciales la salud mental y emocional, la calidad del sue√±o y las relaciones interpersonales."],
                        "answer": "La vida saludable incluye aspectos f√≠sicos, mentales y emocionales, y es necesario aceptar que se puede llegar a ella de diversas maneras."
                    }
                ]
            },
            {
                "title": "Una genialidad",
                "author": "Adaptaci√≥n",
                "content": [
                    "En el ej√©rcito de Felipe Santiago Salaverry hab√≠a unos treinta oficiales excedentes, a los que se les llamaba ‚Äúrabones‚Äù. Iban en las marchas a la vanguardia, siendo los primeros en llegar a los pueblos, donde comet√≠an atropellos infinitos. Al entrar las tropas, ya ellos hab√≠an tomado los mejores alojamientos y matado el hambre y la sed. Con frecuencia, recib√≠a Salaverry quejas de los vecinos por sus abusos, hasta que ‚Äîfastidiado‚Äî llam√≥ al jefe del Estado Mayor, Jos√© Mar√≠a Lastres, y le dijo: ‚ÄúCoronel, re√∫nalos, calif√≠quelos y dest√≠nelos‚Äù.",
                    "Al d√≠a siguiente, le pregunt√≥ don Felipe Santiago: ‚ÄúY bien, coronel... ¬øqu√© ha dispuesto con los rabones?‚Äù.",
                    "‚Äî	He colocado a veinte en el ej√©rcito, pero con los otros, que son corrompidos, francamente no s√© qu√© hacer.",
                    "‚Äî	¬øNo sabe qu√© hacer con ellos? Pues, fus√≠lelos.",
                    "‚Äî	¬°Fusilarlos, mi general! ‚Äìexclam√≥ asustado Lastres.",
                    "‚Äî	S√≠, fus√≠lelos hoy mismo. La patria ganar√° deshaci√©ndose de oficiales indignos de la honrosa carrera de las armas.",
                    "‚Äî	Que los mate el enemigo y no nosotros ‚Äìarguy√≥ Lastres, y le cost√≥ lograr que Salaverry revocase la orden.",
                    "‚Äî	Imp√≥ngales la orden de tomar un fusil y batirse siempre que haya cambio de balas. Ya que no pueden servir como oficiales, que sirvan como hombres ‚Äìdijo Salaverry.",
                    "Pero, la genialidad de Lastres no fue secreto para los rabones. Sabiendo que arriesgaban el pellejo, cambiaron un tanto su conducta, comport√°ndose heroicamente en Uchumayo y Socabaya. Todos menos tres, en diez d√≠as, murieron como bravos en defensa de su bandera y del caudillo que representaba la causa de la voluntad peruana."
                ],
                "quiz": [
                    {
                        "question": "¬øCu√°l de los siguientes hechos ocurri√≥ primero en la historia?",
                        "type": "multiple-choice",
                        "options": ["Salaverry recib√≠a quejas de los vecinos por el actuar de los ‚Äúrabones‚Äù. ", "Hab√≠a unos 30 oficiales excedentes que se llamaban 'rabones.'.", "Don Felipe pregunt√° a Lastres sobre la disposici√≥n de los rabones.","Lastre arguye para que Salaverry revoqu√© la orden."],
                        "answer": "Hab√≠a unos 30 oficiales excedentes que se llamaban 'rabones'."
                    },
                    {
                        "question": "Seg√∫n el texto, ¬øQui√©n dio la orden para el cambio de actitud de los ‚Äúrabones‚Äù?",
                        "type": "multiple-choice",
                        "options": ["Felipe Santiago Salaverry.", "Ricardo Palma.", "Los vecinos de los pueblos.", "Jos√© Mar√≠a Lastres."],
                        "answer": "Jos√© Mar√≠a Lastres."
                    },
                    {
                       "question": "¬øCu√°l es la idea principal de la historia ?",
                        "type": "multiple-choice",
                        "options": ["La valent√≠a de los ‚Äúrabones‚Äù ", "La genialidad de Lastres.", "El liderazgo de Salaverry.", "La redenci√≥n de los ‚Äúrabones‚Äù"],
                        "answer": "La genialidad de Lastres."
                    },
                    {
                        "question": "En la historia, ¬øqu√© significa la palabra ‚Äúrabones‚Äù?",
                        "type": "multiple-choice",
                        "options": ["Se refiere a los oficiales de Salaverry. ", "Se refiere a los oficiales nuevos.", "Se refiere a los oficiales excedentes.", "Se refiere a los oficiales de Lastres"],
                        "answer": "Se refiere a los oficiales excedentes. "
                    },
                    {
                        "question": " Un estudiante ha le√≠do esta tradici√≥n y opin√≥ lo siguiente - Luego, de leer esta historia, creo que Salaverry impuso la disciplina militar para el cambio de conducta en los ‚Äúrabones‚Äù ¬øCu√°l de las siguientes ideas podr√≠a apoyar la opini√≥n de este estudiante?",
                        "type": "multiple-choice",
                        "options": ["Que Salaverry orden√≥ a Lastres fusilarlos por el mal comportamiento", "Que los ‚Äúrabones‚Äù eran los primeros en llegar a los pueblos y consumir los alimentos y bebidas.", "Que los ‚Äúrabones‚Äù al conocer la orden de Salaverry, cambiaron y se comportaron heroicamente", "Que Salaverry impuso la orden de tomar un fusil y batirse siempre que haya cambio de balas."],
                        "answer": "Que Salaverry impuso la orden de tomar un fusil y batirse siempre que haya cambio de balas."
                    },
                    {
                        "question": "6.	Lee las siguientes frases: ‚Ä¢	‚Ä¶, a los que se les llamaba ‚Äúrabones‚Äù. ‚Ä¢	‚Ä¶abusos, hasta que ‚Äîfastidiado‚Äî llam√≥ al jefe‚Ä¶ ¬øCu√°l es la funci√≥n de las comillas y las rayas (‚Äîfastidiado‚Äî) en el texto?",
                        "type": "multiple-choice",
                        "options": ["El primero es para destacar un t√©rmino coloquial en el texto y el segundo, incluye un comentario adicional del autor.", "El primero es para resaltar el tema del texto y el segundo, comenta las caracter√≠sticas del personaje.", "El primero es para enfatizar el significado de la palabra y el segundo, incorpora sin√≥nimos al personaje.", "El primero es para resaltar t√©rminos nuevos en el texto y el segundo, incluye un t√©rmino nuevo."],
                        "answer": "El primero es para destacar un t√©rmino coloquial en el texto y el segundo, incluye un comentario adicional del autor."
                    }
                ]
            },
             {
                    "title": "La batalla de marat√≥n",
                    "author": "Elena Mart√≠nez - 10 de febrero de 2022 - Minedu 2023",
                    "content": [
                    "En el amanecer del 12 de septiembre del 490 a.C., la llanura de Marat√≥n fue testigo de uno de los enfrentamientos m√°s notables de la Antigua Grecia: la Batalla de Marat√≥n. Este episodio hist√≥rico no solo marc√≥ un punto de inflexi√≥n en la Segunda Guerra M√©dica, sino que tambi√©n dej√≥ lecciones perdurables sobre estrategia militar y determinaci√≥n.",
                    "La contienda tuvo lugar entre las fuerzas griegas, lideradas por Atenas y Platea, y el Imperio Persa, bajo el mando de Dar√≠o I. A pesar de contar con muchos menos soldados, los griegos adoptaron una estrategia valiente y audaz que result√≥ decisiva. Estos rompieron las l√≠neas persas, desencadenando un caos que culmin√≥ con una victoria sorprendente para los griegos. Esta movida exitosa, combinada con el coraje de los soldados, destac√≥ la importancia de la t√°ctica y la preparaci√≥n en el campo de batalla.",
                    "La Batalla de Marat√≥n no solo fue un triunfo militar, sino tambi√©n un s√≠mbolo de resistencia y determinaci√≥n. El corredor Fid√≠pides, enviado a Atenas para anunciar la victoria, corri√≥ aproximadamente 42 kil√≥metros, dando origen al marat√≥n moderno y perpetuando la historia de Marat√≥n en la cultura popular.",
                    "Este evento hist√≥rico nos muestra c√≥mo la astucia estrat√©gica y la valent√≠a pueden superar las probabilidades aparentemente insuperables. La Batalla de Marat√≥n marc√≥ un hito en la historia militar y sirvi√≥ como recordatorio de que, incluso en las situaciones m√°s desafiantes, la tenacidad y la astucia pueden prevalecer."
                ], 
                "quiz": [
                    {
                        "question": "De acuerdo con el texto, en la Batalla de Marat√≥n ¬øqui√©n lider√≥ este triunfo militar?",
                        "type": "multiple-choice",
                        "options": ["Atenas y Platea.", "Dar√≠o.", "Fid√≠pedes.", "Los persas."],
                        "answer": "Atenas y Platea."
                    },
                    {
                        "question": "Seg√∫n el texto, ¬øa qu√© se refiere la frase ‚Äúpunto de inflexi√≥n‚Äù?",
                        "type": "multiple-choice",
                        "options": ["Momento de valent√≠a.", "Momento de cambio.", "Momento de intrepidez.", "Momento de coraje."],
                        "answer": "Momento de cambio."
                    },
                    {
                        "question": "Seg√∫n el texto, ¬øcu√°les son las lecciones que nos deja la Batalla de Marat√≥n?",
                        "type": "multiple-choice",
                        "options": ["Valent√≠a y audacia.", "Coraje y preparaci√≥n en el campo.", "Resistencia y determinaci√≥n.", "Astucia y valent√≠a."],
                        "answer": "Resistencia y determinaci√≥n."
                    },
                    {
                        "question": "Respecto a la Batalla de Marat√≥n, c√≥mo episodio hist√≥rico, ¬øqu√© lecciones podemos deducir?",
                        "type": "multiple-choice",
                        "options": ["C√≥mo la valiente estrategia y la audacia superan las adversidades.", "C√≥mo a mayor n√∫mero de soldados se superan los desaf√≠os.", "C√≥mo ser corredor y tener resistencia superan las adversidades.", "C√≥mo ser persa y tener astucia, superan los desaf√≠os."],
                        "answer": "C√≥mo la valiente estrategia y la audacia superan las adversidades."
                    },
                    {
                        "question": "Luego de leer el texto, ¬øcu√°l es el tema principal del texto?",
                        "type": "multiple-choice",
                        "options": ["La Batalla de Marat√≥n y su implicancia hist√≥rica.", "La Batalla de Marat√≥n y el resultado del enfrentamiento.", "El origen del marat√≥n moderno y el triunfo militar.", "El origen del marat√≥n moderno y la inmortalizaci√≥n de su historia."],
                        "answer": "La Batalla de Marat√≥n y su implicancia hist√≥rica."
                    },
                    {
                        "question": "De acuerdo con el texto, ¬øc√≥mo se relaciona la Batalla de Marat√≥n con el origen del marat√≥n moderno?",
                        "type": "multiple-choice",
                        "options": ["La batalla y la acci√≥n de Fid√≠pedes son s√≠mbolos de valent√≠a. ", "El nombre de la llanura da origen al marat√≥n moderno.", "La batalla y la haza√±a de Fid√≠pedes son s√≠mbolos de resistencia.", "El nombre de la batalla da origen al marat√≥n moderno."],
                        "answer": "La batalla y la haza√±a de Fid√≠pedes son s√≠mbolos de resistencia."
                    }
                ]
                }
        ];
        const cuentosData = [

            {
                "title": "Actividad 01",
                "author": "Hans Christian Andersen",
                "content": [
                    "En el campo, cerca de un estanque, viv√≠a una pata con sus patitos. Uno de ellos era muy diferente a los dem√°s, era grande, feo y gris.",
                    "Los otros patitos se burlaban de √©l y su propia madre lo ve√≠a con tristeza. El patito feo se sent√≠a solo y abandonado.",
                    "Un d√≠a, decidi√≥ huir del estanque y buscar un lugar donde pudiera ser aceptado. Vag√≥ por muchos lugares, pasando fr√≠o y hambre.",
                    "Cuando lleg√≥ el invierno, el patito feo estuvo a punto de morir de fr√≠o, pero fue rescatado por un campesino que lo llev√≥ a su casa.",
                    "En primavera, el patito volvi√≥ al estanque y vio un grupo de hermosos cisnes. Para su sorpresa, cuando se acerc√≥ a ellos, se dio cuenta de que √©l tambi√©n se hab√≠a convertido en un hermoso cisne."
                ],
                "quiz": [
                    {
                        "question": "¬øC√≥mo era el patito diferente a los dem√°s?",
                        "type": "multiple-choice",
                        "options": ["Peque√±o y blanco", "Grande, feo y gris", "Flaco y marr√≥n", "Lindo y colorido"],
                        "answer": "Grande, feo y gris"
                    },
                    {
                        "question": "¬øQui√©n se burlaba del patito feo?",
                        "type": "multiple-choice",
                        "options": ["Los gansos", "Su madre", "Los otros patitos", "Los campesinos"],
                        "answer": "Los otros patitos"
                    },
                    {
                        "question": "¬øQu√© le sucedi√≥ al patito feo en primavera?",
                        "type": "short-answer",
                        "answer": "Se convirti√≥ en un hermoso cisne"
                    },
                    {
                        "question": "¬øQui√©n rescat√≥ al patito feo en invierno?",
                        "type": "multiple-choice",
                        "options": ["Un cazador", "Una pata", "Un campesino", "Un perro"],
                        "answer": "Un campesino"
                    },
                    {
                        "question": "¬øQu√© sentimiento predominaba en el patito feo al inicio de la historia?",
                        "type": "short-answer",
                        "answer": "Soledad"
                    }
                ]
            }
        ];

        // Placeholders para actividades adicionales (06-10)
        const actividad06Data = [
            {
                "title": "Actividad 06",
                "author": "Autor",
                "content": [
                    "Contenido de la actividad 06. Reemplaza con el texto real cuando est√© disponible."
                ],
                "quiz": [
                    {
                        "question": "Pregunta ejemplo actividad 06",
                        "type": "short-answer",
                        "answer": "respuesta"
                    }
                ]
            }
        ];

        const actividad07Data = [
            {
                "title": "Actividad 07",
                "author": "Autor",
                "content": [
                    "Contenido de la actividad 07. Reemplaza con el texto real cuando est√© disponible."
                ],
                "quiz": [
                    {
                        "question": "Pregunta ejemplo actividad 07",
                        "type": "short-answer",
                        "answer": "respuesta"
                    }
                ]
            }
        ];

        const actividad08Data = [
            {
                "title": "Actividad 08",
                "author": "Autor",
                "content": [
                    "Contenido de la actividad 08. Reemplaza con el texto real cuando est√© disponible."
                ],
                "quiz": [
                    {
                        "question": "Pregunta ejemplo actividad 08",
                        "type": "short-answer",
                        "answer": "respuesta"
                    }
                ]
            }
        ];

        const actividad09Data = [
            {
                "title": "Actividad 09",
                "author": "Autor",
                "content": [
                    "Contenido de la actividad 09. Reemplaza con el texto real cuando est√© disponible."
                ],
                "quiz": [
                    {
                        "question": "Pregunta ejemplo actividad 09",
                        "type": "short-answer",
                        "answer": "respuesta"
                    }
                ]
            }
        ];

        const actividad10Data = [
            {
                "title": "Actividad 10",
                "author": "Autor",
                "content": [
                    "Contenido de la actividad 10. Reemplaza con el texto real cuando est√© disponible."
                ],
                "quiz": [
                    {
                        "question": "Pregunta ejemplo actividad 10",
                        "type": "short-answer",
                        "answer": "respuesta"
                    }
                ]
            }
        ];

        const novelasData = [
            {
                "title": "Actividad 02",
                "author": "Miguel de Cervantes Saavedra",
                "content": [
                    "En un lugar de la Mancha, de cuyo nombre no quiero acordarme, no ha mucho tiempo que viv√≠a un hidalgo de los de lanza en astillero, adarga antigua, roc√≠n flaco y galgo corredor.",
                    "Una olla de algo m√°s vaca que carnero, salpic√≥n las m√°s noches, duelos y quebrantos los s√°bados, lantejas los viernes, alg√∫n palomino de a√±adidura los domingos, consum√≠an las tres partes de su hacienda.",
                    "El resto della conclu√≠an sayo de velarte, calzas de velludo para las fiestas con sus pantuflos de lo mismo, y los d√≠as de entresemana se honraba con su vellori de lo m√°s fino.",
                    "Ten√≠a en su casa una ama que pasaba de los cuarenta, y una sobrina que no llegaba a los veinte, y un mozo de campo y plaza, que as√≠ ensillaba el roc√≠n como tomaba la podadera.",
                    "Frisaba la edad de nuestro hidalgo con los cincuenta a√±os; era de complexi√≥n recia, seco de carnes, enjuto de rostro, gran madrugador y amigo de la caza. Quieren decir que ten√≠a el sobrenombre de Quijada o Quesada, que en esto hay alguna diferencia en los autores que de este caso escriben; aunque por conjeturas veros√≠miles se deja entender que se llamaba Quijana."
                ],
                "quiz": [
                    {
                        "question": "¬øEn qu√© lugar viv√≠a el hidalgo?",
                        "type": "multiple-choice",
                        "options": ["Andaluc√≠a", "La Mancha", "Extremadura", "Castilla"],
                        "answer": "La Mancha"
                    },
                    {
                        "question": "¬øQu√© edad frisaba el hidalgo?",
                        "type": "multiple-choice",
                        "options": ["Treinta", "Cuarenta", "Cincuenta", "Sesenta"],
                        "answer": "Cincuenta"
                    },
                    {
                        "question": "¬øC√≥mo se llamaba el hidalgo seg√∫n las conjeturas?",
                        "type": "short-answer",
                        "answer": "Quijana"
                    },
                    {
                        "question": "¬øQu√© animal era flaco y ten√≠a el hidalgo?",
                        "type": "multiple-choice",
                        "options": ["Caballo", "Roc√≠n", "Asno", "Mula"],
                        "answer": "Roc√≠n"
                    },
                    {
                        "question": "¬øQu√© comida consum√≠an las m√°s noches?",
                        "type": "short-answer",
                        "answer": "Salpic√≥n"
                    }
                ]
            },
            {
                "title": "Cien A√±os de Soledad (Fragmento)",
                "author": "Gabriel Garc√≠a M√°rquez",
                "content": [
                    "Muchos a√±os despu√©s, frente al pelot√≥n de fusilamiento, el coronel Aureliano Buend√≠a hab√≠a de recordar aquella tarde remota en que su padre lo llev√≥ a conocer el hielo.",
                    "Macondo era entonces una aldea de veinte casas de barro y ca√±abrava construidas a la orilla de un r√≠o de aguas di√°fanas que se precipitaban por un lecho de piedras pulidas, blancas y enormes como huevos prehist√≥ricos.",
                    "El mundo era tan reciente, que muchas cosas carec√≠an de nombre, y para mencionarlas hab√≠a que se√±alarlas con el dedo.",
                    "Todos los a√±os, por el mes de marzo, una familia de gitanos desarrapados plantaba su carpa cerca de la aldea, y con un gran alboroto de pitos y tambores daban a conocer los nuevos inventos.",
                    "Primero llevaron el im√°n. Un gitano corpulento, con barba montaraz y manos de gorri√≥n, que se present√≥ con el nombre de Melqu√≠ades, hizo una p√∫blica demostraci√≥n de lo que √©l llamaba la octava maravilla del mundo."
                ],
                "quiz": [
                    {
                        "question": "¬øQu√© recordaba el coronel Aureliano Buend√≠a frente al pelot√≥n de fusilamiento?",
                        "type": "multiple-choice",
                        "options": ["Su infancia", "El d√≠a que conoci√≥ el hielo", "La guerra", "A su madre"],
                        "answer": "El d√≠a que conoci√≥ el hielo"
                    },
                    {
                        "question": "¬øC√≥mo era Macondo al principio?",
                        "type": "multiple-choice",
                        "options": ["Una ciudad grande", "Un puerto", "Una aldea de veinte casas de barro", "Un campamento militar"],
                        "answer": "Una aldea de veinte casas de barro"
                    },
                    {
                        "question": "¬øQu√© tra√≠an los gitanos a Macondo cada a√±o?",
                        "type": "short-answer",
                        "answer": "Nuevos inventos"
                    },
                    {
                        "question": "¬øQui√©n era Melqu√≠ades?",
                        "type": "multiple-choice",
                        "options": ["El padre del coronel", "Un habitante de Macondo", "Un gitano", "Un soldado"],
                        "answer": "Un gitano"
                    },
                    {
                        "question": "¬øQu√© fue lo primero que llevaron los gitanos?",
                        "type": "short-answer",
                        "answer": "El im√°n"
                    }
                ]
            }
        ];

        const fabulasData = [
            {
                "title": "Actividad 03",
                "author": "Esopo",
                "content": [
                    "Un d√≠a, una liebre se jactaba de su velocidad ante una tortuga, quien, con calma, le propuso una carrera.",
                    "La liebre, confiada en su rapidez, acept√≥ riendo. Al inicio, la liebre corri√≥ muy r√°pido, dejando a la tortuga muy atr√°s.",
                    "Viendo que la tortuga avanzaba muy lentamente, la liebre decidi√≥ tomar una siesta a mitad del camino, segura de que tendr√≠a tiempo de sobra para ganar.",
                    "Mientras la liebre dorm√≠a, la tortuga sigui√≥ avanzando, paso a paso, sin detenerse.",
                    "Cuando la liebre despert√≥, vio con asombro que la tortuga estaba a punto de cruzar la meta. Corri√≥ con todas sus fuerzas, pero ya era demasiado tarde. La tortuga gan√≥ la carrera."
                ],
                "quiz": [
                    {
                        "question": "¬øQui√©n propuso la carrera?",
                        "type": "multiple-choice",
                        "options": ["La liebre", "La tortuga", "Un zorro", "Un p√°jaro"],
                        "answer": "La tortuga"
                    },
                    {
                        "question": "¬øPor qu√© la liebre se detuvo a mitad del camino?",
                        "type": "multiple-choice",
                        "options": ["Estaba cansada", "Quer√≠a esperar a la tortuga", "Decidi√≥ tomar una siesta", "Se perdi√≥"],
                        "answer": "Decidi√≥ tomar una siesta"
                    },
                    {
                        "question": "¬øQu√© hizo la tortuga mientras la liebre dorm√≠a?",
                        "type": "short-answer",
                        "answer": "Sigui√≥ avanzando"
                    },
                    {
                        "question": "¬øCu√°l es la moraleja principal de esta f√°bula?",
                        "type": "multiple-choice",
                        "options": ["La velocidad no importa", "La constancia vence a la rapidez", "Es bueno tomar siestas", "Siempre hay que jactarse"],
                        "answer": "La constancia vence a la rapidez"
                    },
                    {
                        "question": "¬øQu√© animal se jactaba de su velocidad?",
                        "type": "short-answer",
                        "answer": "La liebre"
                    }
                ]
            },
            {
                "title": "El Le√≥n y el Rat√≥n",
                "author": "Esopo",
                "content": [
                    "Un d√≠a, un le√≥n dorm√≠a pl√°cidamente bajo la sombra de un √°rbol. Un peque√±o rat√≥n, sin darse cuenta, pas√≥ corriendo sobre su cara y lo despert√≥.",
                    "El le√≥n, furioso, atrap√≥ al rat√≥n con su pata y estaba a punto de matarlo. El rat√≥n, asustado, le suplic√≥ que lo perdonara, prometiendo que alg√∫n d√≠a le devolver√≠a el favor.",
                    "El le√≥n se ri√≥ de la idea de que un rat√≥n tan peque√±o pudiera ayudar a un rey de la selva, pero, conmovido por su s√∫plica, lo dej√≥ ir.",
                    "Poco tiempo despu√©s, el le√≥n cay√≥ en una trampa de cazadores y qued√≥ atrapado en una red. Rugi√≥ con desesperaci√≥n, pero nadie acudi√≥ en su ayuda.",
                    "El rat√≥n, al escuchar los rugidos, record√≥ su promesa. Corri√≥ hacia el le√≥n y, con sus peque√±os y afilados dientes, roy√≥ las cuerdas de la red hasta liberarlo. El le√≥n aprendi√≥ que incluso los m√°s peque√±os pueden ser de gran ayuda."
                ],
                "quiz": [
                    {
                        "question": "¬øQui√©n despert√≥ al le√≥n?",
                        "type": "multiple-choice",
                        "options": ["Un p√°jaro", "Un rat√≥n", "Un cazador", "Otro le√≥n"],
                        "answer": "Un rat√≥n"
                    },
                    {
                        "question": "¬øQu√© prometi√≥ el rat√≥n al le√≥n?",
                        "type": "multiple-choice",
                        "options": ["Ser su amigo", "Darle comida", "Devolverle el favor", "Nunca volver a molestarlo"],
                        "answer": "Devolverle el favor"
                    },
                    {
                        "question": "¬øC√≥mo ayud√≥ el rat√≥n al le√≥n?",
                        "type": "short-answer",
                        "answer": "Royendo las cuerdas de la red"
                    },
                    {
                        "question": "¬øQu√© lecci√≥n aprendi√≥ el le√≥n?",
                        "type": "multiple-choice",
                        "options": ["Que no debe dormir en el bosque", "Que los ratones son peligrosos", "Que incluso los m√°s peque√±os pueden ser de gran ayuda", "Que debe cazar ratones"],
                        "answer": "Que incluso los m√°s peque√±os pueden ser de gran ayuda"
                    },
                    {
                        "question": "¬øEn qu√© qued√≥ atrapado el le√≥n?",
                        "type": "short-answer",
                        "answer": "En una red"
                    }
                ]
            }
        ];

        const articulosData = [
            {
                "title": "Actividad 04",
                "author": "Equipo de Ecolog√≠a Activa",
                "content": [
                    "El reciclaje es un proceso fundamental para la sostenibilidad de nuestro planeta. Consiste en transformar materiales usados en nuevos productos, reduciendo as√≠ la necesidad de consumir recursos naturales frescos.",
                    "Cada a√±o, millones de toneladas de residuos son generadas en todo el mundo. Gran parte de estos residuos terminan en vertederos, contaminando el suelo, el agua y el aire. El reciclaje ayuda a mitigar este problema.",
                    "Adem√°s de la reducci√≥n de la contaminaci√≥n, el reciclaje tambi√©n ahorra energ√≠a. La fabricaci√≥n de productos a partir de materiales reciclados requiere menos energ√≠a que la producci√≥n a partir de materias primas v√≠rgenes.",
                    "Fomentar el reciclaje en nuestras comunidades es vital. Peque√±as acciones como separar la basura en casa y utilizar contenedores espec√≠ficos para cada tipo de residuo, marcan una gran diferencia.",
                    "Educar a las nuevas generaciones sobre la importancia del reciclaje asegura un futuro m√°s limpio y saludable para todos."
                ],
                "quiz": [
                    {
                        "question": "¬øQu√© es el reciclaje?",
                        "type": "multiple-choice",
                        "options": ["Quemar basura", "Transformar materiales usados en nuevos productos", "Tirar todo a la basura", "Enterrar residuos"],
                        "answer": "Transformar materiales usados en nuevos productos"
                    },
                    {
                        "question": "¬øQu√© se reduce al recicrar?",
                        "type": "multiple-choice",
                        "options": ["El consumo de energ√≠a", "La contaminaci√≥n", "El uso de recursos naturales", "Todas las anteriores"],
                        "answer": "Todas las anteriores"
                    },
                    {
                        "question": "¬øQu√© tipo de contaminaci√≥n ayuda a mitigar el reciclaje?",
                        "type": "short-answer",
                        "answer": "Suelo, agua y aire"
                    },
                    {
                        "question": "¬øC√≥mo podemos fomentar el reciclaje en casa?",
                        "type": "multiple-choice",
                        "options": ["Comprando m√°s cosas", "Separando la basura", "Tirando todo al mismo cubo", "No haciendo nada"],
                        "answer": "Separando la basura"
                    },
                    {
                        "question": "¬øQu√© asegura la educaci√≥n sobre el reciclaje a las nuevas generaciones?",
                        "type": "short-answer",
                        "answer": "Un futuro m√°s limpio y saludable"
                    }
                ]
            },
            {
                "title": "El Ciclo del Agua",
                "author": "National Geographic Kids",
                "content": [
                    "El agua en nuestro planeta est√° siempre en movimiento, en un proceso continuo llamado el ciclo del agua. Este ciclo es esencial para la vida en la Tierra.",
                    "Comienza con la evaporaci√≥n, donde el calor del sol convierte el agua de oc√©anos, r√≠os y lagos en vapor de agua, que sube a la atm√≥sfera.",
                    "En la atm√≥sfera, el vapor de agua se enfr√≠a y se convierte en peque√±as gotas de agua o cristales de hielo, formando las nubes. Este proceso se llama condensaci√≥n.",
                    "Cuando las nubes se llenan de agua, esta cae de nuevo a la Tierra en forma de lluvia, nieve o granizo. Esto es la precipitaci√≥n.",
                    "Finalmente, el agua que cae puede ser absorbida por la tierra, fluir hacia r√≠os y lagos, o regresar a los oc√©anos, completando el ciclo y prepar√°ndose para empezar de nuevo."
                ],
                "quiz": [
                    {
                        "question": "¬øC√≥mo se llama el proceso continuo del agua en el planeta?",
                        "type": "multiple-choice",
                        "options": ["El ciclo de vida", "El ciclo del agua", "El ciclo de la energ√≠a", "El ciclo solar"],
                        "answer": "El ciclo del agua"
                    },
                    {
                        "question": "¬øQu√© ocurre durante la evaporaci√≥n?",
                        "type": "multiple-choice",
                        "options": ["El agua se congela", "El agua se convierte en vapor", "El agua cae como lluvia", "El agua se filtra en la tierra"],
                        "answer": "El agua se convierte en vapor"
                    },
                    {
                        "question": "¬øQu√© se forma durante la condensaci√≥n?",
                        "type": "short-answer",
                        "answer": "Nubes"
                    },
                    {
                        "question": "¬øEn qu√© formas puede caer el agua a la Tierra durante la precipitaci√≥n?",
                        "type": "multiple-choice",
                        "options": ["Vapor y niebla", "Lluvia, nieve o granizo", "Hielo y roc√≠o", "Nubes y neblina"],
                        "answer": "Lluvia, nieve o granizo"
                    },
                    {
                        "question": "¬øQu√© es esencial para la vida en la Tierra seg√∫n el texto?",
                        "type": "short-answer",
                        "answer": "El ciclo del agua"
                    }
                ]
            }
        ];
        const poesiaData = [
          {
            "title": "Actividad 05",
            "author": "Federico Garc√≠a Lorca",
            "content": [
              "En el cielo de la noche, un hombre viejo",
              "con un saco de diamantes y de espejos.",
              "El viento le lleva la risa, el eco,",
              "y siembra luces donde no hay reflejo.",
              "",
              "Cada estrella una promesa, un suspiro,",
              "un faro que gu√≠a al marinero herido.",
              "Con manos de tierra y coraz√≥n de r√≠o,",
              "va pintando el lienzo, el infinito."
            ],
            "quiz": [
              {
                "question": "¬øQui√©n es el personaje principal del poema?",
                "type": "multiple-choice",
                "options": ["Un marinero", "Un hombre viejo", "El viento", "Un pintor"],
                "answer": "Un hombre viejo"
              },
              {
                "question": "¬øQu√© siembra el personaje principal en el cielo?",
                "type": "short-answer",
                "answer": "Estrellas"
              },
              {
                "question": "¬øQu√© representa el 'faro que gu√≠a al marinero herido'?",
                "type": "multiple-choice",
                "options": ["El saco de diamantes", "Las promesas", "Las estrellas", "La risa del hombre"],
                "answer": "Las estrellas"
              },
              {
                "question": "¬øCon qu√© compara el poema al 'lienzo, el infinito'?",
                "type": "multiple-choice",
                "options": ["Un r√≠o", "El coraz√≥n", "El cielo", "La tierra"],
                "answer": "El cielo"
              }
            ]
          },
          {
            "title": "Mariposas de Papel",
            "author": "Alfonsina Storni",
            "content": [
              "Tengo mariposas de papel,",
              "hechas de mis sue√±os m√°s finos.",
              "Con alas de colores pastel,",
              "las dejo volar hacia otros destinos.",
              "",
              "Vuela, mariposa, vuela alto,",
              "que el aire te lleve sin pesar.",
              "En cada aleteo, un canto,",
              "en cada ca√≠da, un despertar."
            ],
            "quiz": [
              {
                "question": "¬øDe qu√© est√°n hechas las mariposas del poema?",
                "type": "short-answer",
                "answer": "De papel"
              },
              {
                "question": "¬øQu√© representan los 'sue√±os m√°s finos'?",
                "type": "multiple-choice",
                "options": ["Los colores de las alas", "Las mariposas de papel", "El aire", "Los destinos"],
                "answer": "Las mariposas de papel"
              },
              {
                "question": "¬øQu√© es lo que la autora le pide a la mariposa?",
                "type": "short-answer",
                "answer": "Que vuele alto"
              },
              {
                "question": "¬øCu√°l es el sentimiento principal en el poema?",
                "type": "multiple-choice",
                "options": ["Tristeza", "Enojo", "Esperanza", "Miedo"],
                "answer": "Esperanza"
              }
            ]
          }
        ];  
        
        // Datos para evaluaci√≥n de salida (vac√≠os por defecto; puedes poblarlos con ejercicios similares a 'entrada')
        const salidaData = [
             {
                "title": "¬øQu√© significa llevar una vida saludable?",
                "author": "Lic. Julissa Choque Pazos / Psic√≥loga del Centro de Salud ‚ÄòSan Juan Mac√≠as - Minedu 2023",
                "content": [
                "Las definiciones y enfoques pueden variar significativamente. En este escenario, se debate sobre si existe una √∫nica f√≥rmula para una vida saludable o si esta es una construcci√≥n personal y subjetiva, basada en factores individuales y valores culturales.",
                    "Mientras algunos sostienen que la vida saludable est√° vinculada a pr√°cticas como la actividad f√≠sica regular y una dieta balanceada, otros argumentan que la salud mental y emocional, as√≠ como la calidad del sue√±o y las relaciones interpersonales, son igualmente cruciales. El dilema se intensifica cuando se considera la presi√≥n social y los est√°ndares est√©ticos que pueden distorsionar la percepci√≥n de una vida saludable.",
                    "Tambi√©n, es esencial reflexionar sobre c√≥mo los valores culturales y las expectativas individuales influyen en nuestras elecciones y percepciones. La comunidad de bienestar se encuentra desafiada a promover una definici√≥n hol√≠stica de la salud, que incluya aspectos f√≠sicos, mentales y emocionales, y a reconocer la diversidad de caminos que pueden llevar a una vida plena y equilibrada",
                    "La reflexi√≥n sobre estos temas nos invita a considerar c√≥mo las distintas definiciones de vida saludable pueden adaptarse a nuestras necesidades individuales y contextos culturales. En este cruce de perspectivas y h√°bitos, la apertura al di√°logo cr√≠tico y la aceptaci√≥n de la diversidad de enfoques se vuelven esenciales para moldear una visi√≥n de la vida saludable que resuene con la autenticidad y bienestar de cada individuo.",
                 ],
                "quiz": [
                    {
                        "question": "Seg√∫n la autora del primer texto, ¬øqu√© est√° en debate sobre tener una vida saludable",
                        "type": "multiple-choice",
                        "options": ["Si la vida saludable est√° vinculada a pr√°cticas como la actividad f√≠sica regular y una dieta balanceada", "Si para tener una vida saludable son cruciales la salud mental y emocional, la calidad de sue√±o y relaciones interpersonales", "Si la vida saludable incluye aspectos f√≠sicos, mentales y emocionales", "Si existe una √∫nica f√≥rmula para la vida saludable o si es una construcci√≥n personal y subjetiva"],
                        "answer": "Si existe una √∫nica f√≥rmula para la vida saludable o si es una construcci√≥n personal y subjetiva"
                    },
                    {
                        "question": "Seg√∫n Carla Pachas, ¬øqu√© tipo de acciones debemos evitar al buscar un estilo de vida saludable?",
                        "type": "multiple-choice",
                        "options": ["Acciones que impliquen sacrificios abrumadores o sufrimientos humanos.", "Acciones que permitan adoptar h√°bitos equilibrados, como una alimentaci√≥n variada", "Acciones sostenibles y realistas a largo plazo", "Acciones para disfrutar de los peque√±os placeres"],
                        "answer": "Acciones que impliquen sacrificios abrumadores o sufrimientos humanos."
                    },
                    {
                        "question": "En el texto de Julissa Choque, ¬øa qu√© se refiere la palabra hol√≠stica?",
                        "type": "multiple-choice",
                        "options": ["A la integralidad.", "A un desaf√≠o.", "A la inclusi√≥n.", "A la diversidad"],
                        "answer": "A la integralidad."
                    },
                    {
                        "question": "Lee esta parte del texto, ‚Äú(‚Ä¶) debemos aprender a disfrutar de los peque√±os placeres (y, por qu√© no, permitirnos algunos ‚Äògustitos‚Äô ocasionales)‚Äù. ¬øCon qu√© intenci√≥n la autora incluye la informaci√≥n entre par√©ntesis?",
                        "type": "multiple-choice",
                        "options": ["Precisar datos espec√≠ficos.", "Insertar informaci√≥n complementaria. ", "Aclarar la definici√≥n adecuada.", "Narrar un hecho complementario."],
                        "answer": "Insertar informaci√≥n complementaria."
                    }
                ]
            },
            {
                "title": "Vida Saludable: Equilibrio y Extremos",
                "author": "Lic. Carla Pachas Vidal - Minedu 2023",
                "content": [
                "En la era actual, la b√∫squeda de un estilo de vida saludable se ha convertido en un objetivo v√°lido, pero debemos evitar extremos que puedan generarnos m√°s estr√©s que beneficios. En medio de las modas y las presiones sociales, es esencial recordar que buscar la vida saludable no implica sacrificios abrumadores ni sufrimientos inhumanos.",
                "Practicar la moderaci√≥n como un camino para la vida saludable nos permite comprender que el bienestar no debe convertirse en una fuente de ansiedad. De esta manera, adoptar h√°bitos equilibrados, como una alimentaci√≥n variada y la incorporaci√≥n de actividad f√≠sica agradable, se vuelve m√°s sostenible y realista a largo plazo.",
                "A pesar de las expectativas actuales, para vivir una vida saludable tambi√©n debemos aprender a disfrutar de los peque√±os placeres (y, por qu√© no, permitirnos algunos ‚Äògustitos‚Äô ocasionales). La obsesi√≥n con la perfecci√≥n en la dieta o el ejercicio puede generar m√°s estr√©s que beneficios reales.",
                "En resumen, el bienestar no debe convertirse en una carga nos insta a apreciar la diversidad y flexibilidad en nuestras elecciones diarias. En un mundo obsesionado con los est√°ndares, encontrar el equilibrio en la b√∫squeda de la salud es la verdadera clave para cultivar una vida plena y sostenible.",    
            ],
                "quiz": [
                    {
                        "question": "¬øQu√© idea es com√∫n entre ambos textos?",
                        "type": "multiple-choice",
                        "options": ["Debemos aceptar y disfrutar el equilibrio de acuerdo con nuestra diversidad y bienestar.", "Debemos adoptar buenos h√°bitos y disfrutar de los peque√±os placeres.", "Debemos encontrar una visi√≥n saludable sin la obsesi√≥n de la perfecci√≥n", "Debemos respetar nuestros valores culturales y percepciones sociales"],
                        "answer": "Debemos encontrar una visi√≥n saludable sin la obsesi√≥n de la perfecci√≥n."
                    },
                    {
                        "question": "Seg√∫n Carla Pachas, buscar una vida saludable no implica sacrificios abrumadores ni sufrimientos inhumanos. ¬øCu√°l de las siguientes ideas presentes en el texto de Julissa Choque incide sobre este mismo aspecto y complementa lo dicho por Carla Pachas?",
                        "type": "multiple-choice",
                        "options": ["La vida saludable incluye aspectos f√≠sicos, mentales y emocionales, y es necesario aceptar que se puede llegar a ella de diversas maneras.", "La presi√≥n social y los est√°ndares est√©ticos pueden distorsionar la idea de una vida saludable.", "La vida saludable se vincula con la actividad f√≠sica regular y una dieta balanceada.", "Son cruciales la salud mental y emocional, la calidad del sue√±o y las relaciones interpersonales."],
                        "answer": "La vida saludable incluye aspectos f√≠sicos, mentales y emocionales, y es necesario aceptar que se puede llegar a ella de diversas maneras."
                    }
                ]
            },
            {
                "title": "Una genialidad",
                "author": "Adaptaci√≥n",
                "content": [
                    "En el ej√©rcito de Felipe Santiago Salaverry hab√≠a unos treinta oficiales excedentes, a los que se les llamaba ‚Äúrabones‚Äù. Iban en las marchas a la vanguardia, siendo los primeros en llegar a los pueblos, donde comet√≠an atropellos infinitos. Al entrar las tropas, ya ellos hab√≠an tomado los mejores alojamientos y matado el hambre y la sed. Con frecuencia, recib√≠a Salaverry quejas de los vecinos por sus abusos, hasta que ‚Äîfastidiado‚Äî llam√≥ al jefe del Estado Mayor, Jos√© Mar√≠a Lastres, y le dijo: ‚ÄúCoronel, re√∫nalos, calif√≠quelos y dest√≠nelos‚Äù.",
                    "Al d√≠a siguiente, le pregunt√≥ don Felipe Santiago: ‚ÄúY bien, coronel... ¬øqu√© ha dispuesto con los rabones?‚Äù.",
                    "‚Äî	He colocado a veinte en el ej√©rcito, pero con los otros, que son corrompidos, francamente no s√© qu√© hacer.",
                    "‚Äî	¬øNo sabe qu√© hacer con ellos? Pues, fus√≠lelos.",
                    "‚Äî	¬°Fusilarlos, mi general! ‚Äìexclam√≥ asustado Lastres.",
                    "‚Äî	S√≠, fus√≠lelos hoy mismo. La patria ganar√° deshaci√©ndose de oficiales indignos de la honrosa carrera de las armas.",
                    "‚Äî	Que los mate el enemigo y no nosotros ‚Äìarguy√≥ Lastres, y le cost√≥ lograr que Salaverry revocase la orden.",
                    "‚Äî	Imp√≥ngales la orden de tomar un fusil y batirse siempre que haya cambio de balas. Ya que no pueden servir como oficiales, que sirvan como hombres ‚Äìdijo Salaverry.",
                    "Pero, la genialidad de Lastres no fue secreto para los rabones. Sabiendo que arriesgaban el pellejo, cambiaron un tanto su conducta, comport√°ndose heroicamente en Uchumayo y Socabaya. Todos menos tres, en diez d√≠as, murieron como bravos en defensa de su bandera y del caudillo que representaba la causa de la voluntad peruana."
                ],
                "quiz": [
                    {
                        "question": "¬øCu√°l de los siguientes hechos ocurri√≥ primero en la historia?",
                        "type": "multiple-choice",
                        "options": ["Salaverry recib√≠a quejas de los vecinos por el actuar de los ‚Äúrabones‚Äù. ", "Hab√≠a unos 30 oficiales excedentes que se llamaban 'rabones.'.", "Don Felipe pregunt√° a Lastres sobre la disposici√≥n de los rabones.","Lastre arguye para que Salaverry revoqu√© la orden."],
                        "answer": "Hab√≠a unos 30 oficiales excedentes que se llamaban 'rabones'."
                    },
                    {
                        "question": "Seg√∫n el texto, ¬øQui√©n dio la orden para el cambio de actitud de los ‚Äúrabones‚Äù?",
                        "type": "multiple-choice",
                        "options": ["Felipe Santiago Salaverry.", "Ricardo Palma.", "Los vecinos de los pueblos.", "Jos√© Mar√≠a Lastres."],
                        "answer": "Jos√© Mar√≠a Lastres."
                    },
                    {
                       "question": "¬øCu√°l es la idea principal de la historia ?",
                        "type": "multiple-choice",
                        "options": ["La valent√≠a de los ‚Äúrabones‚Äù ", "La genialidad de Lastres.", "El liderazgo de Salaverry.", "La redenci√≥n de los ‚Äúrabones‚Äù"],
                        "answer": "La genialidad de Lastres."
                    },
                    {
                        "question": "En la historia, ¬øqu√© significa la palabra ‚Äúrabones‚Äù?",
                        "type": "multiple-choice",
                        "options": ["Se refiere a los oficiales de Salaverry. ", "Se refiere a los oficiales nuevos.", "Se refiere a los oficiales excedentes.", "Se refiere a los oficiales de Lastres"],
                        "answer": "Se refiere a los oficiales excedentes. "
                    },
                    {
                        "question": " Un estudiante ha le√≠do esta tradici√≥n y opin√≥ lo siguiente - Luego, de leer esta historia, creo que Salaverry impuso la disciplina militar para el cambio de conducta en los ‚Äúrabones‚Äù ¬øCu√°l de las siguientes ideas podr√≠a apoyar la opini√≥n de este estudiante?",
                        "type": "multiple-choice",
                        "options": ["Que Salaverry orden√≥ a Lastres fusilarlos por el mal comportamiento", "Que los ‚Äúrabones‚Äù eran los primeros en llegar a los pueblos y consumir los alimentos y bebidas.", "Que los ‚Äúrabones‚Äù al conocer la orden de Salaverry, cambiaron y se comportaron heroicamente", "Que Salaverry impuso la orden de tomar un fusil y batirse siempre que haya cambio de balas."],
                        "answer": "Que Salaverry impuso la orden de tomar un fusil y batirse siempre que haya cambio de balas."
                    },
                    {
                        "question": "6.	Lee las siguientes frases: ‚Ä¢	‚Ä¶, a los que se les llamaba ‚Äúrabones‚Äù. ‚Ä¢	‚Ä¶abusos, hasta que ‚Äîfastidiado‚Äî llam√≥ al jefe‚Ä¶ ¬øCu√°l es la funci√≥n de las comillas y las rayas (‚Äîfastidiado‚Äî) en el texto?",
                        "type": "multiple-choice",
                        "options": ["El primero es para destacar un t√©rmino coloquial en el texto y el segundo, incluye un comentario adicional del autor.", "El primero es para resaltar el tema del texto y el segundo, comenta las caracter√≠sticas del personaje.", "El primero es para enfatizar el significado de la palabra y el segundo, incorpora sin√≥nimos al personaje.", "El primero es para resaltar t√©rminos nuevos en el texto y el segundo, incluye un t√©rmino nuevo."],
                        "answer": "El primero es para destacar un t√©rmino coloquial en el texto y el segundo, incluye un comentario adicional del autor."
                    }
                ]
            },
             {
                    "title": "La batalla de marat√≥n",
                    "author": "Elena Mart√≠nez - 10 de febrero de 2022 - Minedu 2023",
                    "content": [
                    "En el amanecer del 12 de septiembre del 490 a.C., la llanura de Marat√≥n fue testigo de uno de los enfrentamientos m√°s notables de la Antigua Grecia: la Batalla de Marat√≥n. Este episodio hist√≥rico no solo marc√≥ un punto de inflexi√≥n en la Segunda Guerra M√©dica, sino que tambi√©n dej√≥ lecciones perdurables sobre estrategia militar y determinaci√≥n.",
                    "La contienda tuvo lugar entre las fuerzas griegas, lideradas por Atenas y Platea, y el Imperio Persa, bajo el mando de Dar√≠o I. A pesar de contar con muchos menos soldados, los griegos adoptaron una estrategia valiente y audaz que result√≥ decisiva. Estos rompieron las l√≠neas persas, desencadenando un caos que culmin√≥ con una victoria sorprendente para los griegos. Esta movida exitosa, combinada con el coraje de los soldados, destac√≥ la importancia de la t√°ctica y la preparaci√≥n en el campo de batalla.",
                    "La Batalla de Marat√≥n no solo fue un triunfo militar, sino tambi√©n un s√≠mbolo de resistencia y determinaci√≥n. El corredor Fid√≠pides, enviado a Atenas para anunciar la victoria, corri√≥ aproximadamente 42 kil√≥metros, dando origen al marat√≥n moderno y perpetuando la historia de Marat√≥n en la cultura popular.",
                    "Este evento hist√≥rico nos muestra c√≥mo la astucia estrat√©gica y la valent√≠a pueden superar las probabilidades aparentemente insuperables. La Batalla de Marat√≥n marc√≥ un hito en la historia militar y sirvi√≥ como recordatorio de que, incluso en las situaciones m√°s desafiantes, la tenacidad y la astucia pueden prevalecer."
                ], 
                "quiz": [
                    {
                        "question": "De acuerdo con el texto, en la Batalla de Marat√≥n ¬øqui√©n lider√≥ este triunfo militar?",
                        "type": "multiple-choice",
                        "options": ["Atenas y Platea.", "Dar√≠o.", "Fid√≠pedes.", "Los persas."],
                        "answer": "Atenas y Platea."
                    },
                    {
                        "question": "Seg√∫n el texto, ¬øa qu√© se refiere la frase ‚Äúpunto de inflexi√≥n‚Äù?",
                        "type": "multiple-choice",
                        "options": ["Momento de valent√≠a.", "Momento de cambio.", "Momento de intrepidez.", "Momento de coraje."],
                        "answer": "Momento de cambio."
                    },
                    {
                        "question": "Seg√∫n el texto, ¬øcu√°les son las lecciones que nos deja la Batalla de Marat√≥n?",
                        "type": "multiple-choice",
                        "options": ["Valent√≠a y audacia.", "Coraje y preparaci√≥n en el campo.", "Resistencia y determinaci√≥n.", "Astucia y valent√≠a."],
                        "answer": "Resistencia y determinaci√≥n."
                    },
                    {
                        "question": "Respecto a la Batalla de Marat√≥n, c√≥mo episodio hist√≥rico, ¬øqu√© lecciones podemos deducir?",
                        "type": "multiple-choice",
                        "options": ["C√≥mo la valiente estrategia y la audacia superan las adversidades.", "C√≥mo a mayor n√∫mero de soldados se superan los desaf√≠os.", "C√≥mo ser corredor y tener resistencia superan las adversidades.", "C√≥mo ser persa y tener astucia, superan los desaf√≠os."],
                        "answer": "C√≥mo la valiente estrategia y la audacia superan las adversidades."
                    },
                    {
                        "question": "Luego de leer el texto, ¬øcu√°l es el tema principal del texto?",
                        "type": "multiple-choice",
                        "options": ["La Batalla de Marat√≥n y su implicancia hist√≥rica.", "La Batalla de Marat√≥n y el resultado del enfrentamiento.", "El origen del marat√≥n moderno y el triunfo militar.", "El origen del marat√≥n moderno y la inmortalizaci√≥n de su historia."],
                        "answer": "La Batalla de Marat√≥n y su implicancia hist√≥rica."
                    },
                    {
                        "question": "De acuerdo con el texto, ¬øc√≥mo se relaciona la Batalla de Marat√≥n con el origen del marat√≥n moderno?",
                        "type": "multiple-choice",
                        "options": ["La batalla y la acci√≥n de Fid√≠pedes son s√≠mbolos de valent√≠a. ", "El nombre de la llanura da origen al marat√≥n moderno.", "La batalla y la haza√±a de Fid√≠pedes son s√≠mbolos de resistencia.", "El nombre de la batalla da origen al marat√≥n moderno."],
                        "answer": "La batalla y la haza√±a de Fid√≠pedes son s√≠mbolos de resistencia."
                    }
                ]
                }
            ];
        document.addEventListener('DOMContentLoaded', () => {
            const textCategorySelect = document.getElementById('textCategory');
            const textTitle = document.getElementById('textTitle');
            const textAuthor = document.getElementById('textAuthor');
            const textContent = document.getElementById('textContent');
            const readAloudBtn = document.getElementById('readAloudBtn');
            const increaseFontSizeBtn = document.getElementById('increaseFontSizeBtn');
            const decreaseFontSizeBtn = document.getElementById('decreaseFontSizeBtn');
            const toggleThemeBtn = document.getElementById('toggleThemeBtn');
            const startQuizBtn = document.getElementById('startQuizBtn');
            const readingMessage = document.getElementById('readingMessage');
            const quizSection = document.getElementById('quizSection');
            const quizQuestionsContainer = document.getElementById('quizQuestions');
            const submitQuizBtn = document.getElementById('submitQuizBtn');
            const retryQuizBtn = document.getElementById('retryQuizBtn');
            const quizFeedback = document.getElementById('quizFeedback');

            // Elementos para Evaluaciones y export
            const evalSection = document.getElementById('evalSection');
            const evalTitle = document.getElementById('evalTitle');
            const evalTextContainer = document.getElementById('evalTextContainer');
            const evalQuizContainer = document.getElementById('evalQuizContainer');
            const submitEvalBtn = document.getElementById('submitEvalBtn');
            const evalSummary = document.getElementById('evalSummary');
            const startEntryEvalBtn = document.getElementById('startEntryEvalBtn');
            const startExitEvalBtn = document.getElementById('startExitEvalBtn');
            const exportAnswersBtn = document.getElementById('exportAnswersBtn');

            const studentNameInput = document.getElementById('studentName');
            const studentGradeInput = document.getElementById('studentGrade');
            const activateStudentBtn = document.getElementById('activateStudent');
            const studentForm = document.querySelector('.student-form');
            const studentInfo = document.querySelector('.student-info');
            const currentStudentNameSpan = document.getElementById('currentStudentName');
            const currentStudentGradeSpan = document.getElementById('currentStudentGrade');
            const totalScoreSpan = document.getElementById('totalScore');
            const levelAchievedSpan = document.getElementById('levelAchieved');
            const readTextsList = document.getElementById('readTextsList');
            const studentRankingList = document.getElementById('studentRanking');
            const registerNewStudentBtn = document.getElementById('registerNewStudentBtn');


            let currentText = null;
            let currentCategory = 'actividad01';
            let currentQuiz = null;
            let currentFontSize = 1.1; // Rem
            let currentStudent = null;
            let studentScores = JSON.parse(localStorage.getItem('studentScores')) || {};
            let lastDisplayedTextIndexPerCategory = {}; // Para asegurar que se elija un texto diferente

            const loadTexts = async (category) => {
                switch (category) {
                    case 'actividad01':
                        return cuentosData;
                    case 'actividad02':
                        return novelasData;
                    case 'actividad03':
                        return fabulasData;
                    case 'actividad04':
                        return articulosData;
                    case 'actividad05':
                        return poesiaData;
                    case 'actividad06':
                        return actividad06Data;
                    case 'actividad07':
                        return actividad07Data;
                    case 'actividad08':
                        return actividad08Data;
                    case 'actividad09':
                        return actividad09Data;
                    case 'actividad10':
                        return actividad10Data;
                    default:
                        return [];
                }
            };

            const displayText = (text) => {
                currentText = text;

                // --- MODIFICACI√ìN: L√≥gica de la Evaluaci√≥n de Entrada (Bot√≥n de Ingreso y Doble Columna) ---
                if (currentCategory === 'entrada' && entradaData.length >= 2) {
                    textTitle.textContent = 'Evaluaci√≥n de Entrada'; // T√≠tulo de categor√≠a
                    textAuthor.textContent = 'Instrucciones: Lee atentamente y responde el cuestionario al final.';
                    textContent.innerHTML = `<p class="placeholder-text">Presiona el bot√≥n 'Iniciar Evaluaci√≥n' para comenzar la lectura y ver el texto en doble columna.</p>`;
                    startQuizBtn.textContent = '‚ñ∂Ô∏è Iniciar Evaluaci√≥n';
                } else {
                    // Comportamiento est√°ndar para las dem√°s categor√≠as
                    textTitle.textContent = text.title;
                    textAuthor.textContent = `Autor: ${text.author}`;
                    textContent.innerHTML = text.content.map(p => `<p>${p}</p>`).join('');
                    textContent.style.fontSize = `${currentFontSize}rem`;
                    startQuizBtn.textContent = '‚úÖ Iniciar Quiz de Comprensi√≥n';
                }
                // --- FIN MODIFICACI√ìN DE ENTRADA ---

                    readingMessage.style.display = 'none';
                    quizSection.style.display = 'none';
                    // ocultar secci√≥n de evaluaci√≥n si est√° visible
                    if (evalSection) evalSection.style.display = 'none';
                startQuizBtn.style.display = 'block';

                window.speechSynthesis.cancel();
                readAloudBtn.textContent = 'üó£Ô∏è Leer en Voz Alta';
            };

            const selectRandomText = async () => {
                const texts = await loadTexts(currentCategory);
                if (texts.length > 0) {
                    let newIndex;

                    // Si la categor√≠a es 'entrada', no seleccionamos al azar, preparamos el bot√≥n de inicio
                    if (currentCategory === 'entrada') {
                        // El bot√≥n de inicio mostrar√° los primeros dos textos
                        newIndex = 0; 
                        // Creamos un currentText temporal que el displayText pueda usar
                        currentText = { 
                            title: 'Evaluaci√≥n de Entrada', 
                            author: '', 
                            content: [], 
                            quiz: [...texts[0].quiz, ...texts[1].quiz] 
                        }; 
                        displayText(currentText);
                        return;
                    }


                    // L√≥gica para textos est√°ndar (articulos, poesia, etc.)
                    const lastIndex = lastDisplayedTextIndexPerCategory[currentCategory];

                    if (texts.length > 1) {
                        do {
                            newIndex = Math.floor(Math.random() * texts.length);
                        } while (newIndex === lastIndex);
                    } else {
                        newIndex = 0;
                    }

                    lastDisplayedTextIndexPerCategory[currentCategory] = newIndex;
                    console.log(`Categor√≠a: ${currentCategory}, Texto seleccionado: ${texts[newIndex].title}`);
                    displayText(texts[newIndex]);
                } else {
                    textTitle.textContent = '';
                    textAuthor.textContent = '';
                    textContent.innerHTML = `<p class="placeholder-text">No hay textos disponibles en esta categor√≠a.</p>`;
                    startQuizBtn.style.display = 'none';
                }
            };
            
            // --- Funcionalidad de Voz (speechSynthesis) ---
            let currentUtterance = null; // Variable para mantener la referencia a la s√≠ntesis de voz

            readAloudBtn.addEventListener('click', () => {
                if (!('speechSynthesis' in window) || !currentText) {
                    console.error('Tu navegador no soporta la lectura en voz alta o no hay texto seleccionado.');
                    return;
                }
                
                // NO PERMITIMOS LECTURA EN VOZ ALTA EN EL ESTADO INICIAL DE 'ENTRADA'
                if (currentCategory === 'entrada' && textContent.querySelector('.placeholder-text')) {
                    alert('Presiona "Iniciar Evaluaci√≥n" para leer el texto.');
                    return;
                }


                if (window.speechSynthesis.speaking) {
                    // Si est√° hablando (o pausado), cancela la lectura
                    window.speechSynthesis.cancel();
                    readAloudBtn.textContent = 'üó£Ô∏è Leer en Voz Alta'; // Vuelve al estado inicial
                    console.log('Lectura detenida.');
                } else {
                    // Si no est√° hablando, inicia una nueva lectura
                    // Para el caso de doble columna, lee todo el contenido visible
                    const textToSpeak = currentText.content.join(' '); 
                    currentUtterance = new SpeechSynthesisUtterance(textToSpeak);
                    currentUtterance.lang = 'es-ES';
                    window.speechSynthesis.speak(currentUtterance);
                    readAloudBtn.textContent = 'üõë Detener Lectura'; // Cambia el texto para indicar que se puede detener
                    console.log('Iniciando nueva lectura.');

                    currentUtterance.onend = () => {
                        readAloudBtn.textContent = 'üó£Ô∏è Leer en Voz Alta'; // Vuelve al estado inicial al finalizar
                        currentUtterance = null;
                        console.log('Lectura finalizada.');
                    };
                }
            });

            // --- Cambio de tama√±o de texto ---
            increaseFontSizeBtn.addEventListener('click', () => {
                currentFontSize = Math.min(currentFontSize + 0.1, 2.0); // L√≠mite superior
                textContent.style.fontSize = `${currentFontSize}rem`;
            });

            decreaseFontSizeBtn.addEventListener('click', () => {
                currentFontSize = Math.max(currentFontSize - 0.1, 0.8); // L√≠mite inferior
                textContent.style.fontSize = `${currentFontSize}rem`;
            });

            // --- Modo Claro/Oscuro ---
            toggleThemeBtn.addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                const isDarkMode = document.body.classList.contains('dark-mode');
                localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
            });

            // Cargar preferencia de tema al iniciar
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
            }

            // --- Registro y Seguimiento de Estudiantes ---
            const saveStudentScores = () => {
                localStorage.setItem('studentScores', JSON.stringify(studentScores));
            };

            const updateStudentUI = () => {
                // studentForm is always visible
                // studentInfo is always visible
                if (currentStudent) {
                    currentStudentNameSpan.textContent = currentStudent.name;
                    currentStudentGradeSpan.textContent = currentStudent.grade;
                    totalScoreSpan.textContent = currentStudent.totalScore;
                    updateLevel(currentStudent.totalScore);
                    // Hide the student input form when a student is active
                    studentForm.style.display = 'none';
                    studentInfo.style.display = 'block';
                } else {
                    studentNameInput.value = ''; // Limpiar campos al no haber estudiante activo
                    studentGradeInput.value = '';
                    currentStudentNameSpan.textContent = 'Ninguno'; // Placeholder
                    currentStudentGradeSpan.textContent = 'N/A'; // Placeholder
                    totalScoreSpan.textContent = '0';
                    levelAchievedSpan.textContent = 'N/A';
                    levelAchievedSpan.className = ''; // Limpiar clases de nivel
                    // Show the student input form when no student is active
                    studentForm.style.display = 'block';
                    studentInfo.style.display = 'none'; // Hide student info when no student is active
                }
                renderReadTexts();
                renderRanking();
            };

            const updateLevel = (score) => {
                let level = '';
                let levelClass = '';
                if (score >= 400) {
                    level = 'Logro Destacado (AD)';
                    levelClass = 'level-ad'; // Verde
                } else if (score >= 250) {
                    level = 'Logrado (A)';
                    levelClass = 'level-a'; // Anaranjado
                } else if (score >= 100) {
                    level = 'Proceso (B)';
                    levelClass = 'level-b'; // Amarillo
                } else {
                    level = 'Inicio (C)';
                    levelClass = 'level-c'; // Rojo
                }
                levelAchievedSpan.textContent = level;
                levelAchievedSpan.className = '';
                levelAchievedSpan.classList.add(levelClass);
            };

            const renderReadTexts = () => {
                readTextsList.innerHTML = '';
                if (currentStudent && currentStudent.readTexts) {
                    currentStudent.readTexts.forEach(text => {
                        const li = document.createElement('li');
                        li.textContent = text;
                        readTextsList.appendChild(li);
                    });
                }
            };

            const renderRanking = () => {
                studentRankingList.innerHTML = '';
                const sortedStudents = Object.values(studentScores).sort((a, b) => b.totalScore - a.totalScore);
                sortedStudents.forEach((student, index) => {
                    const li = document.createElement('li');
                    li.textContent = `${index + 1}. ${student.name} (${student.grade}) - ${student.totalScore} pts`;
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.classList.add('delete-student-btn');
                    deleteBtn.textContent = 'üóëÔ∏è';
                    deleteBtn.title = `Eliminar a ${student.name}`;
                    deleteBtn.dataset.studentKey = student.name.toLowerCase().replace(/\s/g, '-'); // Usar la clave para identificar
                    li.appendChild(deleteBtn);

                    studentRankingList.appendChild(li);
                });

                // Listeners para los botones de Evaluaci√≥n en la barra lateral
                startEntryEvalBtn && startEntryEvalBtn.addEventListener('click', () => {
                    startEvaluation('entrada');
                });

                startExitEvalBtn && startExitEvalBtn.addEventListener('click', () => {
                    startEvaluation('salida');
                });
            };

            // Funci√≥n para eliminar estudiante
            const deleteStudent = (studentKeyToDelete) => {
                if (confirm(`¬øEst√°s seguro de que quieres eliminar el registro de este estudiante?`)) { // Usar confirm para simplicidad, idealmente un modal
                    delete studentScores[studentKeyToDelete];
                    saveStudentScores();
                    if (currentStudent && currentStudent.name.toLowerCase().replace(/\s/g, '-') === studentKeyToDelete) {
                        currentStudent = null; // Si se elimina el estudiante activo, se desactiva
                    }
                    updateStudentUI();
                    console.log(`Estudiante con clave ${studentKeyToDelete} eliminado.`);
                }
            };

            // Delegaci√≥n de eventos para los botones de eliminar
            studentRankingList.addEventListener('click', (event) => {
                if (event.target.classList.contains('delete-student-btn')) {
                    const studentKeyToDelete = event.target.dataset.studentKey;
                    deleteStudent(studentKeyToDelete);
                }
            });


            activateStudentBtn.addEventListener('click', () => {
                const name = studentNameInput.value.trim();
                const grade = studentGradeInput.value.trim();

                if (name && grade) {
                    const studentKey = name.toLowerCase().replace(/\s/g, '-');
                    if (!studentScores[studentKey]) {
                        studentScores[studentKey] = {
                            name: name,
                            grade: grade,
                            totalScore: 0,
                            readTexts: []
                        };
                    }
                    currentStudent = studentScores[studentKey];
                    localStorage.setItem('lastActiveStudent', studentKey);
                    saveStudentScores();
                    updateStudentUI();
                    console.log(`¬°Bienvenido(a), ${name} de ${grade}!`);
                } else {
                    console.error('Por favor, ingresa tu nombre completo y grado para activar el seguimiento.');
                }
            });

            registerNewStudentBtn.addEventListener('click', () => {
                currentStudent = null;
                localStorage.removeItem('lastActiveStudent');
                updateStudentUI(); // Esto har√° visible el formulario y limpiar√° los campos
                console.log('Preparado para registrar un nuevo estudiante.');
            });


            const lastActiveStudentName = localStorage.getItem('lastActiveStudent');
            if (lastActiveStudentName && studentScores[lastActiveStudentName]) {
                currentStudent = studentScores[lastActiveStudentName];
                updateStudentUI();
            } else {
                updateStudentUI(); // Asegurarse de que el formulario est√© visible si no hay estudiante activo
            }

            // --- Quiz de Comprensi√≥n (Funciones y Listeners Modificados) ---

            // Funci√≥n auxiliar para el flujo normal del quiz
            const startQuizAfterReading = () => {
                if (!currentText || !currentText.quiz || currentText.quiz.length === 0) {
                    console.warn('Este texto no tiene preguntas de comprensi√≥n asociadas.');
                    return;
                }
                readingMessage.style.display = 'block';
                setTimeout(() => {
                    quizSection.style.display = 'block';
                    readingMessage.style.display = 'none';
                    startQuizBtn.style.display = 'none';
                    generateQuiz(currentText.quiz);
                }, 1500);
            }

            // MODIFICACI√ìN: Listener del bot√≥n de inicio (act√∫a como "Ingresar" en entrada)
            const handleStartQuizClick = async () => {
                if (currentCategory === 'entrada' && textContent.querySelector('.placeholder-text')) {
                    // L√≥gica especial para mostrar los textos de entrada en dos columnas
                    const texts = await loadTexts('entrada');
                    if (texts.length >= 2) {
                        
                        // Combinar los dos primeros textos en un formato de doble columna
                        textContent.innerHTML = `
                            <div class="two-column-layout">
                                <div class="column-text">
                                    <h3>${texts[0].title}</h3>
                                    <p class="author-label">Autor: ${texts[0].author}</p>
                                    ${texts[0].content.map(p => `<p>${p}</p>`).join('')}
                                </div>
                                <div class="column-text">
                                    <h3>${texts[1].title}</h3>
                                    <p class="author-label">Autor: ${texts[1].author}</p>
                                    ${texts[1].content.map(p => `<p>${p}</p>`).join('')}
                                </div>
                            </div>
                        `;
                        // Se actualiza el currentText con el quiz combinado
                        currentText = {
                            title: 'Evaluaci√≥n de Entrada - Le√≠do',
                            author: 'Evaluaci√≥n de Entrada',
                            content: [...texts[0].content, ...texts[1].content],
                            quiz: [...texts[0].quiz, ...texts[1].quiz]
                        }; 
                        
                        // Cambiar el bot√≥n para que ahora inicie el quiz
                        startQuizBtn.textContent = 'Responder las preguntas';
                        
                        // Reemplazar el listener temporal por el listener de quiz normal
                        startQuizBtn.removeEventListener('click', handleStartQuizClick); 
                        startQuizBtn.addEventListener('click', startQuizAfterReading); 
                        
                        // Aplicar tama√±o de fuente
                        textContent.style.fontSize = `${currentFontSize}rem`;
                        return;
                    }
                }
                
                // Si no es 'entrada' o si ya se mostr√≥ el texto, llama al flujo normal
                startQuizAfterReading();
            };

            startQuizBtn.addEventListener('click', handleStartQuizClick);


            // Definici√≥n de generateQuiz (parte previamente solicitada)
            const generateQuiz = (quiz) => {
                currentQuiz = quiz;
                quizQuestionsContainer.innerHTML = '';
                quizFeedback.textContent = '';
                submitQuizBtn.style.display = 'block';
                retryQuizBtn.style.display = 'none';

                quiz.forEach((q, index) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.classList.add('question');
                    questionDiv.innerHTML = `<p>${index + 1}. ${q.question}</p>`;

                    if (q.type === 'multiple-choice') {
                        q.options.forEach((option, optionIndex) => {
                            questionDiv.innerHTML += `
                                <label>
                                    <input type="radio" name="question${index}" value="${option}">
                                    ${option}
                                </label>
                            `;
                        });
                    } else if (q.type === 'short-answer') {
                        const inputId = `quizQuestion${index}`; // ID √∫nico para el input
                        questionDiv.innerHTML += `
                            <div class="input-with-speech">
                                <input type="text" id="${inputId}" name="question${index}" class="short-answer-input" placeholder="Escribe tu respuesta aqu√≠">
                                <button class="speech-input-btn" data-target="${inputId}" title="Dictar respuesta">üé§</button>
                            </div>
                        `;
                    }
                    quizQuestionsContainer.appendChild(questionDiv);
                });
            };

            // MODIFICACI√ìN: Listener del bot√≥n de enviar quiz (A√±adido resumen de respuestas)
            submitQuizBtn.addEventListener('click', () => {
                let correctAnswers = 0;
                let totalQuestions = currentQuiz.length;
                let resultsSummary = '<ol class="results-list">'; // Lista ordenada para el resumen

                currentQuiz.forEach((q, index) => {
                    const questionDiv = quizQuestionsContainer.children[index];
                    let isCorrect = false;
                    let userAnswer = 'Sin responder';
                    let questionResultClass = 'incorrect';


                    if (q.type === 'multiple-choice') {
                        const selectedOption = document.querySelector(`input[name="question${index}"]:checked`);
                        if (selectedOption) {
                            userAnswer = selectedOption.value;
                            if (userAnswer === q.answer) {
                                isCorrect = true;
                            }
                        }
                        document.querySelectorAll(`input[name="question${index}"]`).forEach(input => input.disabled = true);
                    } else if (q.type === 'short-answer') {
                        const input = document.querySelector(`input[name="question${index}"]`);
                        if (input) {
                            userAnswer = input.value.trim();
                            if (input.value.trim().toLowerCase() === q.answer.toLowerCase()) {
                                isCorrect = true;
                            }
                        }
                        input.disabled = true;
                        // Tambi√©n deshabilitar el bot√≥n de dictado de voz asociado
                        const speechButton = input.nextElementSibling;
                        if (speechButton && speechButton.classList.contains('speech-input-btn')) {
                            speechButton.disabled = true;
                        }
                    }

                    if (isCorrect) {
                        correctAnswers++;
                        questionResultClass = 'correct';
                        let feedbackSpan = questionDiv.querySelector('.feedback-span');
                        if (!feedbackSpan) {
                            feedbackSpan = document.createElement('span');
                            feedbackSpan.classList.add('feedback-span');
                            questionDiv.appendChild(feedbackSpan);
                        }
                        feedbackSpan.style.marginLeft = '10px';
                        feedbackSpan.style.fontWeight = 'bold';
                        feedbackSpan.style.color = 'green';
                        feedbackSpan.textContent = '‚úîÔ∏è Correcto';
                    } else {
                        let feedbackSpan = questionDiv.querySelector('.feedback-span');
                        if (!feedbackSpan) {
                            feedbackSpan = document.createElement('span');
                            feedbackSpan.classList.add('feedback-span');
                            questionDiv.appendChild(feedbackSpan);
                        }
                        feedbackSpan.style.marginLeft = '10px';
                        feedbackSpan.style.fontWeight = 'bold';
                        feedbackSpan.style.color = 'red';
                        feedbackSpan.textContent = `‚ùå Incorrecto (Correcta: ${q.answer})`;
                    }

                    // L√≥gica para el Resumen Final (MODIFICACI√ìN)
                    resultsSummary += `<li class="${questionResultClass}">
                        <p><strong>Pregunta ${index + 1}:</strong> ${q.question}</p>
                        <p>Tu Respuesta: <em>${userAnswer || 'Sin responder'}</em></p>
                        <p>Respuesta Correcta: <strong>${q.answer}</strong></p>
                    </li>`;
                });
                
                resultsSummary += '</ol>'; // Cerrar la lista de resumen

                const score = correctAnswers * 10;
                
                // Mostrar el feedback del score con el resumen detallado (MODIFICACI√ìN)
                quizFeedback.innerHTML = `
                    <h3>Resultados del Quiz</h3>
                    <p>Has acertado ${correctAnswers} de ${totalQuestions} preguntas. Tu puntaje en el quiz es: <strong>${score} puntos</strong>.</p>
                    <hr>
                    <h4>Resumen por Ejercicio:</h4>
                    ${resultsSummary}
                `;

                if (currentStudent) {
                    currentStudent.totalScore += score;
                    if (!currentStudent.readTexts.includes(currentText.title)) {
                        currentStudent.readTexts.push(currentText.title);
                    }
                    saveStudentScores();
                    updateStudentUI();
                }

                submitQuizBtn.style.display = 'none';
                retryQuizBtn.style.display = 'block';

                setTimeout(() => {
                    quizSection.style.display = 'none';
                    // Mostrar la secci√≥n de evaluaci√≥n / resumen en lugar de comentarios
                    if (evalSection) {
                        evalSection.style.display = 'block';
                        evalSummary.innerHTML = quizFeedback.innerHTML || '<p>Resumen disponible.</p>';
                    }
                }, 2000);
            });

            retryQuizBtn.addEventListener('click', () => {
                generateQuiz(currentQuiz);
            });

            // --- Secci√≥n de Comentarios ---
           // --- Inicializaci√≥n de Dictado de Voz ---
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const speechRecognitionSupported = SpeechRecognition !== undefined;

                if (!speechRecognitionSupported) {
                    console.warn('El reconocimiento de voz no es compatible con este navegador.');
                    document.querySelectorAll('.speech-input-btn').forEach(btn => btn.disabled = true);
                }

                // Delegaci√≥n de eventos para los botones de dictado de voz
                document.addEventListener('click', (event) => {
                    if (event.target.classList.contains('speech-input-btn')) {
                        const button = event.target;
                        if (!speechRecognitionSupported) {
                            alert('El reconocimiento de voz no es compatible con tu navegador. Por favor, actualiza o usa otro navegador.');
                            return;
                        }

                        // SOLO soporta inputs de respuesta corta (ya no hay textarea de comentarios)
                        const targetId = button.dataset.target;
                        const targetInput = document.getElementById(targetId);

                        if (!targetInput) return; 

                        const recognition = new SpeechRecognition();
                        recognition.continuous = false; 
                        recognition.interimResults = false; 
                        recognition.lang = 'es-ES'; 

                        recognition.onstart = () => {
                            button.textContent = 'üî¥ Grabando...';
                            button.disabled = true; 
                        };

                        recognition.onresult = (event) => {
                            const transcript = event.results[0][0].transcript;
                            targetInput.value = transcript; 
                        };

                        recognition.onerror = (event) => {
                            console.error('Error de reconocimiento de voz:', event.error);
                            button.textContent = 'üé§'; 
                            button.disabled = false; 
                            alert(`Error en el reconocimiento de voz: ${event.error}. Aseg√∫rate de que tu micr√≥fono est√© conectado y permitas el acceso.`);
                        };

                        recognition.onend = () => {
                            button.textContent = 'üé§'; 
                            button.disabled = false; 
                        };

                        recognition.start();
                    }
                });

                // --- Funci√≥n para exportar .xls (HTML que Excel abre) ---
                // Generar y descargar un .xls (HTML que Excel abre) a partir de un array de filas
                const downloadXLS = (rows, filename = 'respuestas.xls') => {
                    if (!rows || !rows.length) {
                        alert('No hay datos para exportar.');
                        return;
                    }
                    let html = '<table><thead><tr>';
                    const headers = Object.keys(rows[0] || {});
                    headers.forEach(h => { html += `<th>${h}</th>`; });
                    html += '</tr></thead><tbody>';
                    rows.forEach(r => {
                        html += '<tr>';
                        headers.forEach(h => {
                            const cell = (r[h] !== undefined && r[h] !== null) ? r[h] : '';
                            html += `<td>${String(cell).replace(/</g,'&lt;')}</td>`;
                        });
                        html += '</tr>';
                    });
                    html += '</tbody></table>';

                    const blob = new Blob([html], { type: 'application/vnd.ms-excel' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                };

                // Handler del bot√≥n exportar (Evaluaciones): exporta SOLO resultados de evaluaciones acumuladas
                exportAnswersBtn && exportAnswersBtn.addEventListener('click', () => {
                    if (evalState && Array.isArray(evalState.rows) && evalState.rows.length) {
                        const now = new Date();
                        const fname = `evaluacion_${evalState.mode}_${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2,'0')}-${now.getDate().toString().padStart(2,'0')}_${now.getHours().toString().padStart(2,'0')}${now.getMinutes().toString().padStart(2,'0')}.xls`;
                        downloadXLS(evalState.rows, fname);
                    } else {
                        alert('No hay resultados de evaluaci√≥n para exportar.');
                    }
                });

                // Handler para exportar la actividad actual (no mezclada con evaluaciones)
                const exportActivityBtn = document.getElementById('exportActivityBtn');
                exportActivityBtn && exportActivityBtn.addEventListener('click', () => {
                    const now = new Date();
                    const fecha = now.toLocaleDateString();
                    const hora = now.toLocaleTimeString();
                    const student = currentStudent ? currentStudent.name : 'N/A';
                    const grade = currentStudent ? currentStudent.grade : 'N/A';
                    const category = currentCategory || 'N/A';
                    const textTitleValue = currentText ? currentText.title : 'N/A';

                    const rows = [];
                    if (currentQuiz && currentQuiz.length) {
                        currentQuiz.forEach((q, i) => {
                            let userAnswer = 'Sin responder';
                            if (q.type === 'multiple-choice') {
                                const sel = document.querySelector(`input[name="question${i}"]:checked`);
                                userAnswer = sel ? sel.value : userAnswer;
                            } else {
                                const inp = document.querySelector(`#quizQuestion${i}`);
                                userAnswer = inp ? inp.value.trim() : userAnswer;
                            }
                            const result = (userAnswer && String(userAnswer).toLowerCase() === String(q.answer).toLowerCase()) ? 'Correcto' : 'Incorrecto';
                            rows.push({
                                'Fecha': fecha,
                                'Hora': hora,
                                'Estudiante': student,
                                'Grado': grade,
                                'Categor√≠a': category,
                                'Texto': textTitleValue,
                                'Pregunta': q.question,
                                'Respuesta del estudiante': userAnswer,
                                'Respuesta correcta': q.answer,
                                'Resultado': result
                            });
                        });
                    } else {
                        alert('No hay respuestas de actividad para exportar. Realiza primero el quiz de la actividad.');
                        return;
                    }
                    const fname = `actividad_${category}_${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2,'0')}-${now.getDate().toString().padStart(2,'0')}_${now.getHours().toString().padStart(2,'0')}${now.getMinutes().toString().padStart(2,'0')}.xls`;
                    if (rows.length) downloadXLS(rows, fname);
                });

                // --- Flujo secuencial de Evaluaci√≥n (entrada/salida) ---
                let evalState = null; // { mode, exercises: [], currentIndex, rows }
                let currentEvalQuiz = null; // { quiz, exIndex }

                const buildExercisesFromData = (data) => {
                    const exercises = [];
                    if (!Array.isArray(data) || data.length === 0) return exercises;

                    if (data.length >= 4) {
                        // Primer ejercicio = combinaci√≥n de los dos primeros en doble columna
                        exercises.push({ type: 'double', columns: [data[0], data[1]], quiz: [...(data[0].quiz || []), ...(data[1].quiz || [])], title: 'Ejercicio 1 '});
                        exercises.push({ type: 'single', text: data[2], quiz: data[2].quiz || [], title: 'Ejercicio 2'});
                        exercises.push({ type: 'single', text: data[3], quiz: data[3].quiz || [], title: 'Ejercicio 3'});
                    } else if (data.length === 3) {
                        exercises.push({ type: 'double', columns: [data[0], data[1]], quiz: [...(data[0].quiz || []), ...(data[1].quiz || [])], title: 'Ejercicio 1 '});
                        exercises.push({ type: 'single', text: data[2], quiz: data[2].quiz || [], title: 'Ejercicio 2'});
                        // Duplicar el √∫ltimo para completar 3 ejercicios (informar al usuario)
                        exercises.push({ type: 'single', text: data[2], quiz: data[2].quiz || [], title: 'Ejercicio 3 (duplicado)'});
                        alert('Nota: La evaluaci√≥n contiene 3 ejercicios; se duplic√≥ el √∫ltimo texto por falta de uno adicional.');
                    } else if (data.length === 2) {
                        exercises.push({ type: 'double', columns: [data[0], data[1]], quiz: [...(data[0].quiz || []), ...(data[1].quiz || [])], title: 'Ejercicio 1 '});
                        exercises.push({ type: 'single', text: data[0], quiz: data[0].quiz || [], title: 'Ejercicio 2 (duplicado)'});
                        exercises.push({ type: 'single', text: data[1], quiz: data[1].quiz || [], title: 'Ejercicio 3 (duplicado)'});
                        alert('Nota: Datos insuficientes; se duplicaron textos para completar 3 ejercicios.');
                    } else { // 1 or less
                        exercises.push({ type: 'single', text: data[0], quiz: data[0].quiz || [], title: 'Ejercicio 1'});
                        exercises.push({ type: 'single', text: data[0], quiz: data[0].quiz || [], title: 'Ejercicio 2 (duplicado)'});
                        exercises.push({ type: 'single', text: data[0], quiz: data[0].quiz || [], title: 'Ejercicio 3 (duplicado)'});
                        alert('Datos de evaluaci√≥n muy limitados; se duplicaron textos para formar 3 ejercicios.');
                    }
                    return exercises;
                };

                const showExercise = (index) => {
                    if (!evalState || !evalState.exercises || index < 0 || index >= evalState.exercises.length) return;
                    const ex = evalState.exercises[index];
                    evalTextContainer.innerHTML = '';
                    evalQuizContainer.innerHTML = '';
                    if (evalState && evalState.mode === 'entrada') {
                        evalTitle.textContent = 'Evaluaci√≥n de entrada';
                    } else if (evalState && evalState.mode === 'salida') {
                        evalTitle.textContent = 'Evaluaci√≥n de salida';
                    } else {
                        evalTitle.textContent = 'Evaluaci√≥n';
                    }
                    evalProgress.textContent = `Ejercicio ${index + 1} de ${evalState.exercises.length}`;

                    if (ex.type === 'double') {
                        const left = ex.columns[0];
                        const right = ex.columns[1];
                        evalTextContainer.innerHTML = `
                            <div class="two-column-layout">
                                <div class="column-text">
                                    <h3>${left.title}</h3>
                                    <p class="author-label">Autor: ${left.author || ''}</p>
                                    ${left.content.map(p => `<p>${p}</p>`).join('')}
                                </div>
                                <div class="column-text">
                                    <h3>${right.title}</h3>
                                    <p class="author-label">Autor: ${right.author || ''}</p>
                                    ${right.content.map(p => `<p>${p}</p>`).join('')}
                                </div>
                            </div>
                        `;
                    } else if (ex.type === 'single') {
                        const t = ex.text;
                        evalTextContainer.innerHTML = `
                            <h3>${t.title}</h3>
                            <p class="author-label">Autor: ${t.author || ''}</p>
                            ${t.content.map(p => `<p>${p}</p>`).join('')}
                        `;
                    }

                    // Generar el quiz para este ejercicio
                    generateEvalQuiz(ex.quiz || [], index);
                };

                const generateEvalQuiz = (quiz, exIndex) => {
                    currentEvalQuiz = { quiz: quiz || [], exIndex };
                    evalQuizContainer.innerHTML = '';
                    if (!quiz || quiz.length === 0) {
                        evalQuizContainer.innerHTML = '<p>No hay preguntas para este ejercicio.</p>';
                        return;
                    }
                    quiz.forEach((q, qIndex) => {
                        const qDiv = document.createElement('div');
                        qDiv.classList.add('question');
                        qDiv.innerHTML = `<p>${qIndex + 1}. ${q.question}</p>`;
                        const name = `eval_${exIndex}_q${qIndex}`;
                        if (q.type === 'multiple-choice') {
                            q.options.forEach(opt => {
                                qDiv.innerHTML += `
                                    <label>
                                        <input type="radio" name="${name}" value="${opt}">
                                        ${opt}
                                    </label>
                                `;
                            });
                        } else {
                            const inputId = `eval_${exIndex}_input_${qIndex}`;
                            qDiv.innerHTML += `
                                <div class="input-with-speech">
                                    <input type="text" id="${inputId}" name="${name}" class="short-answer-input" placeholder="Escribe tu respuesta aqu√≠">
                                    <button class="speech-input-btn" data-target="${inputId}" title="Dictar respuesta">üé§</button>
                                </div>
                            `;
                        }
                        evalQuizContainer.appendChild(qDiv);
                    });
                };

                submitEvalBtn && submitEvalBtn.addEventListener('click', () => {
                    if (!evalState) return;
                    const exIndex = evalState.currentIndex;
                    const ex = evalState.exercises[exIndex];
                    const quiz = ex.quiz || [];
                    let correct = 0;
                    const now = new Date();
                    const fecha = now.toLocaleDateString();
                    const hora = now.toLocaleTimeString();
                    const rowsThisExercise = [];

                    quiz.forEach((q, i) => {
                        let userAnswer = 'Sin responder';
                        if (q.type === 'multiple-choice') {
                            const sel = document.querySelector(`input[name="eval_${exIndex}_q${i}"]:checked`);
                            userAnswer = sel ? sel.value : userAnswer;
                        } else {
                            const inp = document.getElementById(`eval_${exIndex}_input_${i}`);
                            userAnswer = inp ? inp.value.trim() : userAnswer;
                        }
                        const result = (userAnswer && String(userAnswer).toLowerCase() === String(q.answer).toLowerCase()) ? 'Correcto' : 'Incorrecto';
                        if (result === 'Correcto') correct++;
                        rowsThisExercise.push({
                            'Fecha': fecha,
                            'Hora': hora,
                            'Estudiante': currentStudent ? currentStudent.name : 'N/A',
                            'Grado': currentStudent ? currentStudent.grade : 'N/A',
                            'Categor√≠a': evalState.mode,
                            'Texto': ex.type === 'double' ? `${ex.columns[0].title} | ${ex.columns[1].title}` : (ex.text ? ex.text.title : ''),
                            'Pregunta': q.question,
                            'Respuesta del estudiante': userAnswer,
                            'Respuesta correcta': q.answer,
                            'Resultado': result
                        });
                    });

                    const score = correct * 10;
                    // Guardar resultados
                    evalState.rows.push(...rowsThisExercise);
                    // Actualizar puntaje del estudiante
                    if (currentStudent) {
                        currentStudent.totalScore += score;
                        saveStudentScores();
                        updateStudentUI();
                    }

                    // Mostrar resumen de este ejercicio
                    const summaryHtml = `
                        <h4>Resumen Ejercicio ${exIndex + 1}</h4>
                        <p>Aciertos: ${correct} de ${quiz.length}. Puntaje: ${score} pts.</p>
                    `;
                    evalSummary.innerHTML = summaryHtml + (evalSummary.innerHTML || '');

                    // Avanzar autom√°ticamente al siguiente ejercicio o finalizar
                    evalState.currentIndex++;
                    if (evalState.currentIndex < evalState.exercises.length) {
                        // Mostrar siguiente ejercicio
                        setTimeout(() => {
                            showExercise(evalState.currentIndex);
                        }, 800);
                    } else {
                        // Finalizado: mostrar resumen final y habilitar exportaci√≥n
                        setTimeout(() => {
                            evalTextContainer.innerHTML = '';
                            evalQuizContainer.innerHTML = '';
                            if (evalState && evalState.mode === 'entrada') {
                                evalTitle.textContent = 'Evaluaci√≥n de entrada';
                            } else if (evalState && evalState.mode === 'salida') {
                                evalTitle.textContent = 'Evaluaci√≥n de salida';
                            } else {
                                evalTitle.textContent = 'Evaluaci√≥n';
                            }
                            evalProgress.textContent = `Completada`;
                            // Mostrar resumen completo
                            let finalHtml = '<h3>Resumen Final</h3>';
                            const totalCorrect = evalState.rows.filter(r => r.Resultado === 'Correcto' || r.Resultado === 'Correcto').length;
                            finalHtml += `<p>Total de preguntas registradas: ${evalState.rows.length}</p>`;
                            finalHtml += `<p>Estudiante: ${currentStudent ? currentStudent.name : 'N/A'}</p>`;
                            finalHtml += '<p>Puedes exportar los resultados usando "Exportar Respuestas (.xls)".</p>';
                            evalSummary.innerHTML = finalHtml + '<hr>' + evalSummary.innerHTML;
                            // Preparar descarga inmediata opcional: no descargar autom√°ticamente, esperar al usuario
                        }, 500);
                    }
                });

                // Iniciar evaluaci√≥n (botones ya agregados) -- funci√≥n p√∫blica
                const startEvaluation = (mode) => {
                    const data = (mode === 'entrada') ? entradaData : salidaData;
                    const exercises = buildExercisesFromData(data);
                    if (!exercises || exercises.length === 0) {
                        alert('No hay ejercicios configurados para esta evaluaci√≥n.');
                        return;
                    }
                    evalState = { mode, exercises, currentIndex: 0, rows: [] };
                    evalSummary.innerHTML = '';
                    if (evalSection) evalSection.style.display = 'block';
                    showExercise(0);
                };

                // Inicializaci√≥n al cargar la p√°gina
                selectRandomText();

                // Event listener para el cambio de categor√≠a
                textCategorySelect.addEventListener('change', () => {
                    currentCategory = textCategorySelect.value;
                    
                    startQuizBtn.removeEventListener('click', startQuizAfterReading); 
                    startQuizBtn.removeEventListener('click', handleStartQuizClick); 
                    startQuizBtn.addEventListener('click', handleStartQuizClick); 
                    
                    selectRandomText();
                });
            });
        </script>
</body>
</html>



